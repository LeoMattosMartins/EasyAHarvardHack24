/*! For license information please see index.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StacksStacking=e():t.StacksStacking=e()}(this,(()=>(()=>{var t,e,n={525:(t,e)=>{"use strict";function n(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function r(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)}function i(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function o(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");n(t.outputLen),n(t.blockLen)}function s(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a(t,e){i(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}Object.defineProperty(e,"__esModule",{value:!0}),e.output=e.exists=e.hash=e.bytes=e.bool=e.number=void 0,e.number=n,e.bool=r,e.bytes=i,e.hash=o,e.exists=s,e.output=a;const c={number:n,bool:r,bytes:i,hash:o,exists:s,output:a};e.default=c},350:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SHA2=void 0;const r=n(525),i=n(64);class o extends i.Hash{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,i.createView)(this.buffer)}update(t){r.default.exists(this);const{view:e,buffer:n,blockLen:o}=this,s=(t=(0,i.toBytes)(t)).length;for(let r=0;r<s;){const a=Math.min(o-this.pos,s-r);if(a!==o)n.set(t.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===o&&(this.process(e,0),this.pos=0);else{const e=(0,i.createView)(t);for(;o<=s-r;r+=o)this.process(e,r)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){r.default.exists(this),r.default.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:o,isLE:s}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let t=a;t<o;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,u=r?0:4;t.setUint32(e+c,s,r),t.setUint32(e+u,a,r)}(n,o-8,BigInt(8*this.length),s),this.process(n,0);const c=(0,i.createView)(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=u/4,d=this.get();if(h>d.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<h;t++)c.setUint32(4*t,d[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return t.length=r,t.pos=s,t.finished=i,t.destroyed=o,r%e&&t.buffer.set(n),t}}e.SHA2=o},661:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.crypto=void 0,e.crypto={node:void 0,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0}},53:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sha224=e.sha256=void 0;const r=n(350),i=n(64),o=(t,e,n)=>t&e^t&n^e&n,s=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),c=new Uint32Array(64);class u extends r.SHA2{constructor(){super(64,32,8,!1),this.A=0|a[0],this.B=0|a[1],this.C=0|a[2],this.D=0|a[3],this.E=0|a[4],this.F=0|a[5],this.G=0|a[6],this.H=0|a[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[t,e,n,r,i,o,s,a]}set(t,e,n,r,i,o,s,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)c[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=c[t-15],n=c[t-2],r=(0,i.rotr)(e,7)^(0,i.rotr)(e,18)^e>>>3,o=(0,i.rotr)(n,17)^(0,i.rotr)(n,19)^n>>>10;c[t]=o+c[t-7]+r+c[t-16]|0}let{A:n,B:r,C:a,D:u,E:h,F:d,G:f,H:l}=this;for(let t=0;t<64;t++){const e=l+((0,i.rotr)(h,6)^(0,i.rotr)(h,11)^(0,i.rotr)(h,25))+((p=h)&d^~p&f)+s[t]+c[t]|0,g=((0,i.rotr)(n,2)^(0,i.rotr)(n,13)^(0,i.rotr)(n,22))+o(n,r,a)|0;l=f,f=d,d=h,h=u+e|0,u=a,a=r,r=n,n=e+g|0}var p;n=n+this.A|0,r=r+this.B|0,a=a+this.C|0,u=u+this.D|0,h=h+this.E|0,d=d+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,r,a,u,h,d,f,l)}roundClean(){c.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class h extends u{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}e.sha256=(0,i.wrapConstructor)((()=>new u)),e.sha224=(0,i.wrapConstructor)((()=>new h))},64:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomBytes=e.wrapConstructorWithOpts=e.wrapConstructor=e.checkOpts=e.Hash=e.concatBytes=e.toBytes=e.utf8ToBytes=e.asyncLoop=e.nextTick=e.hexToBytes=e.bytesToHex=e.isLE=e.rotr=e.createView=e.u32=e.u8=void 0;const r=n(661);if(e.u8=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e.u32=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),e.createView=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),e.rotr=(t,e)=>t<<32-e|t>>>e,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],!e.isLE)throw new Error("Non little-endian hardware is not supported");const i=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function o(t){if("string"!=typeof t)throw new TypeError("utf8ToBytes expected string, got "+typeof t);return(new TextEncoder).encode(t)}function s(t){if("string"==typeof t&&(t=o(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}e.bytesToHex=function(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=i[t[n]];return e},e.hexToBytes=function(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=2*n,i=t.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[n]=o}return e},e.nextTick=async()=>{},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=o,e.toBytes=s,e.concatBytes=function(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n},e.Hash=class{clone(){return this._cloneInto()}},e.checkOpts=function(t,e){if(void 0!==e&&("object"!=typeof e||(n=e,"[object Object]"!==Object.prototype.toString.call(n)||n.constructor!==Object)))throw new TypeError("Options should be object or undefined");var n;return Object.assign(t,e)},e.wrapConstructor=function(t){const e=e=>t().update(s(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e},e.wrapConstructorWithOpts=function(t){const e=(e,n)=>t(n).update(s(e)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=e=>t(e),e},e.randomBytes=function(t=32){if(r.crypto.web)return r.crypto.web.getRandomValues(new Uint8Array(t));if(r.crypto.node)return new Uint8Array(r.crypto.node.randomBytes(t).buffer);throw new Error("The environment doesn't have randomBytes function")}},166:t=>{"use strict";t.exports=function(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var r=0;r<t.length;r++){var i=t.charAt(r),o=i.charCodeAt(0);if(255!==e[o])throw new TypeError(i+" is ambiguous");e[o]=r}var s=t.length,a=t.charAt(0),c=Math.log(s)/Math.log(256),u=Math.log(256)/Math.log(s);function h(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var n=0,r=0,i=0;t[n]===a;)r++,n++;for(var o=(t.length-n)*c+1>>>0,u=new Uint8Array(o);t[n];){var h=e[t.charCodeAt(n)];if(255===h)return;for(var d=0,f=o-1;(0!==h||d<i)&&-1!==f;f--,d++)h+=s*u[f]>>>0,u[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=d,n++}for(var l=o-i;l!==o&&0===u[l];)l++;for(var p=new Uint8Array(r+(o-l)),g=r;l!==o;)p[g++]=u[l++];return p}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var n=0,r=0,i=0,o=e.length;i!==o&&0===e[i];)i++,n++;for(var c=(o-i)*u+1>>>0,h=new Uint8Array(c);i!==o;){for(var d=e[i],f=0,l=c-1;(0!==d||f<r)&&-1!==l;l--,f++)d+=256*h[l]>>>0,h[l]=d%s>>>0,d=d/s>>>0;if(0!==d)throw new Error("Non-zero carry");r=f,i++}for(var p=c-r;p!==c&&0===h[p];)p++;for(var g=a.repeat(n);p<c;++p)g+=t.charAt(h[p]);return g},decodeUnsafe:h,decode:function(t){var e=h(t);if(e)return e;throw new Error("Non-base"+s+" character")}}}},766:(t,e)=>{"use strict";for(var n=[],r=[],i=("undefined"!=typeof Uint8Array&&Uint8Array,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o=0;o<64;++o)n[o]=i[o],r[i.charCodeAt(o)]=o;r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},22:(t,e,n)=>{const r=n(166);t.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},98:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32ToB58=e.b58ToC32=e.c32addressDecode=e.c32address=e.versions=void 0;const r=n(392),i=n(716),o=n(64);e.versions={mainnet:{p2pkh:22,p2sh:20},testnet:{p2pkh:26,p2sh:21}};const s={};s[0]=e.versions.mainnet.p2pkh,s[5]=e.versions.mainnet.p2sh,s[111]=e.versions.testnet.p2pkh,s[196]=e.versions.testnet.p2sh;const a={};function c(t,e){if(!e.match(/^[0-9a-fA-F]{40}$/))throw new Error("Invalid argument: not a hash160 hex string");return`S${(0,r.c32checkEncode)(t,e)}`}function u(t){if(t.length<=5)throw new Error("Invalid c32 address: invalid length");if("S"!=t[0])throw new Error('Invalid c32 address: must start with "S"');return(0,r.c32checkDecode)(t.slice(1))}a[e.versions.mainnet.p2pkh]=0,a[e.versions.mainnet.p2sh]=5,a[e.versions.testnet.p2pkh]=111,a[e.versions.testnet.p2sh]=196,e.c32address=c,e.c32addressDecode=u,e.b58ToC32=function(t,e=-1){const n=i.decode(t),r=(0,o.bytesToHex)(n.data),a=parseInt((0,o.bytesToHex)(n.prefix),16);let u;return e<0?(u=a,void 0!==s[a]&&(u=s[a])):u=e,c(u,r)},e.c32ToB58=function(t,e=-1){const n=u(t),r=n[0],o=n[1];let s;e<0?(s=r,void 0!==a[r]&&(s=a[r])):s=e;let c=s.toString(16);return 1===c.length&&(c=`0${c}`),i.encode(o,c)}},716:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.encode=void 0;const r=n(53),i=n(64),o=n(166),s="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";e.encode=function(t,e="00"){const n="string"==typeof t?(0,i.hexToBytes)(t):t,a="string"==typeof e?(0,i.hexToBytes)(e):t;if(!(n instanceof Uint8Array&&a instanceof Uint8Array))throw new TypeError("Argument must be of type Uint8Array or string");const c=(0,r.sha256)((0,r.sha256)(new Uint8Array([...a,...n])));return o(s).encode([...a,...n,...c.slice(0,4)])},e.decode=function(t){const e=o(s).decode(t),n=e.slice(0,1),i=e.slice(1,-4),a=(0,r.sha256)((0,r.sha256)(new Uint8Array([...n,...i])));return e.slice(-4).forEach(((t,e)=>{if(t!==a[e])throw new Error("Invalid checksum")})),{prefix:n,data:i}}},392:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32checkDecode=e.c32checkEncode=void 0;const r=n(53),i=n(64),o=n(103);function s(t){const e=(0,r.sha256)((0,r.sha256)((0,i.hexToBytes)(t)));return(0,i.bytesToHex)(e.slice(0,4))}e.c32checkEncode=function(t,e){if(t<0||t>=32)throw new Error("Invalid version (must be between 0 and 31)");if(!e.match(/^[0-9a-fA-F]*$/))throw new Error("Invalid data (not a hex string)");(e=e.toLowerCase()).length%2!=0&&(e=`0${e}`);let n=t.toString(16);1===n.length&&(n=`0${n}`);const r=s(`${n}${e}`),i=(0,o.c32encode)(`${e}${r}`);return`${o.c32[t]}${i}`},e.c32checkDecode=function(t){t=(0,o.c32normalize)(t);const e=(0,o.c32decode)(t.slice(1)),n=t[0],r=o.c32.indexOf(n),i=e.slice(-8);let a=r.toString(16);if(1===a.length&&(a=`0${a}`),s(`${a}${e.substring(0,e.length-8)}`)!==i)throw new Error("Invalid c32check string: checksum mismatch");return[r,e.substring(0,e.length-8)]}},103:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32decode=e.c32normalize=e.c32encode=e.c32=void 0;const r=n(64);e.c32="0123456789ABCDEFGHJKMNPQRSTVWXYZ";const i="0123456789abcdef";function o(t){return t.toUpperCase().replace(/O/g,"0").replace(/L|I/g,"1")}e.c32encode=function(t,n){if(!t.match(/^[0-9a-fA-F]*$/))throw new Error("Not a hex-encoded string");t.length%2!=0&&(t=`0${t}`);let o=[],s=0;for(let n=(t=t.toLowerCase()).length-1;n>=0;n--)if(s<4){const r=i.indexOf(t[n])>>s;let a=0;0!==n&&(a=i.indexOf(t[n-1]));const c=1+s,u=a%(1<<c)<<5-c,h=e.c32[r+u];s=c,o.unshift(h)}else s=0;let a=0;for(let t=0;t<o.length&&"0"===o[t];t++)a++;o=o.slice(a);const c=(new TextDecoder).decode((0,r.hexToBytes)(t)).match(/^\u0000*/),u=c?c[0].length:0;for(let t=0;t<u;t++)o.unshift(e.c32[0]);if(n){const t=n-o.length;for(let n=0;n<t;n++)o.unshift(e.c32[0])}return o.join("")},e.c32normalize=o,e.c32decode=function(t,n){if(!(t=o(t)).match(`^[${e.c32}]*$`))throw new Error("Not a c32-encoded string");const r=t.match(`^${e.c32[0]}*`),s=r?r[0].length:0;let a=[],c=0,u=0;for(let n=t.length-1;n>=0;n--){4===u&&(a.unshift(i[c]),u=0,c=0);const r=(e.c32.indexOf(t[n])<<u)+c,o=i[r%16];if(u+=1,c=r>>4,c>1<<u)throw new Error("Panic error in decoding.");a.unshift(o)}a.unshift(i[c]),a.length%2==1&&a.unshift("0");let h=0;for(let t=0;t<a.length&&"0"===a[t];t++)h++;a=a.slice(h-h%2);let d=a.join("");for(let t=0;t<s;t++)d=`00${d}`;if(n){const t=2*n-d.length;for(let e=0;e<t;e+=2)d=`00${d}`}return d}},870:(t,e,n)=>{"use strict";e.yI=e.H4=void 0;n(103),n(392);const r=n(98);Object.defineProperty(e,"H4",{enumerable:!0,get:function(){return r.c32address}}),Object.defineProperty(e,"yI",{enumerable:!0,get:function(){return r.c32addressDecode}})},907:(t,e,n)=>{t=n.nmd(t);var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object Boolean]",a="[object Date]",c="[object Function]",u="[object GeneratorFunction]",h="[object Map]",d="[object Number]",f="[object Object]",l="[object Promise]",p="[object RegExp]",g="[object Set]",y="[object String]",w="[object Symbol]",b="[object WeakMap]",A="[object ArrayBuffer]",m="[object DataView]",E="[object Float32Array]",S="[object Float64Array]",v="[object Int8Array]",x="[object Int16Array]",I="[object Int32Array]",C="[object Uint8Array]",_="[object Uint8ClampedArray]",T="[object Uint16Array]",P="[object Uint32Array]",k=/\w*$/,R=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,B={};B[o]=B["[object Array]"]=B[A]=B[m]=B[s]=B[a]=B[E]=B[S]=B[v]=B[x]=B[I]=B[h]=B[d]=B[f]=B[p]=B[g]=B[y]=B[w]=B[C]=B[_]=B[T]=B[P]=!0,B["[object Error]"]=B[c]=B[b]=!1;var N="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,U="object"==typeof self&&self&&self.Object===Object&&self,H=N||U||Function("return this")(),D=e&&!e.nodeType&&e,$=D&&t&&!t.nodeType&&t,L=$&&$.exports===D;function K(t,e){return t.set(e[0],e[1]),t}function M(t,e){return t.add(e),t}function j(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function G(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function F(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function W(t,e){return function(n){return t(e(n))}}function V(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var q,z=Array.prototype,X=Function.prototype,Z=Object.prototype,J=H["__core-js_shared__"],Y=(q=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",Q=X.toString,tt=Z.hasOwnProperty,et=Z.toString,nt=RegExp("^"+Q.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=L?H.Buffer:void 0,it=H.Symbol,ot=H.Uint8Array,st=W(Object.getPrototypeOf,Object),at=Object.create,ct=Z.propertyIsEnumerable,ut=z.splice,ht=Object.getOwnPropertySymbols,dt=rt?rt.isBuffer:void 0,ft=W(Object.keys,Object),lt=Ht(H,"DataView"),pt=Ht(H,"Map"),gt=Ht(H,"Promise"),yt=Ht(H,"Set"),wt=Ht(H,"WeakMap"),bt=Ht(Object,"create"),At=Mt(lt),mt=Mt(pt),Et=Mt(gt),St=Mt(yt),vt=Mt(wt),xt=it?it.prototype:void 0,It=xt?xt.valueOf:void 0;function Ct(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _t(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Tt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Pt(t){this.__data__=new _t(t)}function kt(t,e,n){var r=t[e];tt.call(t,e)&&jt(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function Rt(t,e){for(var n=t.length;n--;)if(jt(t[n][0],e))return n;return-1}function Ot(t,e,n,r,i,l,b){var R;if(r&&(R=l?r(t,i,l,b):r(t)),void 0!==R)return R;if(!qt(t))return t;var O=Gt(t);if(O){if(R=function(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&tt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!e)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,R)}else{var N=$t(t),U=N==c||N==u;if(Wt(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(N==f||N==o||U&&!l){if(G(t))return l?t:{};if(R=function(t){return"function"!=typeof t.constructor||Kt(t)?{}:qt(e=st(t))?at(e):{};var e}(U?{}:t),!e)return function(t,e){return Nt(t,Dt(t),e)}(t,function(t,e){return t&&Nt(e,zt(e),t)}(R,t))}else{if(!B[N])return l?t:{};R=function(t,e,n,r){var i,o=t.constructor;switch(e){case A:return Bt(t);case s:case a:return new o(+t);case m:return function(t,e){var n=e?Bt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,r);case E:case S:case v:case x:case I:case C:case _:case T:case P:return function(t,e){var n=e?Bt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,r);case h:return function(t,e,n){return j(e?n(F(t),!0):F(t),K,new t.constructor)}(t,r,n);case d:case y:return new o(t);case p:return function(t){var e=new t.constructor(t.source,k.exec(t));return e.lastIndex=t.lastIndex,e}(t);case g:return function(t,e,n){return j(e?n(V(t),!0):V(t),M,new t.constructor)}(t,r,n);case w:return i=t,It?Object(It.call(i)):{}}}(t,N,Ot,e)}}b||(b=new Pt);var H=b.get(t);if(H)return H;if(b.set(t,R),!O)var D=n?function(t){return function(t,e,n){var r=e(t);return Gt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,zt,Dt)}(t):zt(t);return function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n););}(D||t,(function(i,o){D&&(i=t[o=i]),kt(R,o,Ot(i,e,n,r,o,t,b))})),R}function Bt(t){var e=new t.constructor(t.byteLength);return new ot(e).set(new ot(t)),e}function Nt(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var s=e[i],a=r?r(n[s],t[s],s,n,t):void 0;kt(n,s,void 0===a?t[s]:a)}return n}function Ut(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Ht(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!qt(t)||(e=t,Y&&Y in e))&&(Vt(t)||G(t)?nt:R).test(Mt(t));var e}(n)?n:void 0}Ct.prototype.clear=function(){this.__data__=bt?bt(null):{}},Ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Ct.prototype.get=function(t){var e=this.__data__;if(bt){var n=e[t];return n===r?void 0:n}return tt.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return bt?void 0!==e[t]:tt.call(e,t)},Ct.prototype.set=function(t,e){return this.__data__[t]=bt&&void 0===e?r:e,this},_t.prototype.clear=function(){this.__data__=[]},_t.prototype.delete=function(t){var e=this.__data__,n=Rt(e,t);return!(n<0||(n==e.length-1?e.pop():ut.call(e,n,1),0))},_t.prototype.get=function(t){var e=this.__data__,n=Rt(e,t);return n<0?void 0:e[n][1]},_t.prototype.has=function(t){return Rt(this.__data__,t)>-1},_t.prototype.set=function(t,e){var n=this.__data__,r=Rt(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},Tt.prototype.clear=function(){this.__data__={hash:new Ct,map:new(pt||_t),string:new Ct}},Tt.prototype.delete=function(t){return Ut(this,t).delete(t)},Tt.prototype.get=function(t){return Ut(this,t).get(t)},Tt.prototype.has=function(t){return Ut(this,t).has(t)},Tt.prototype.set=function(t,e){return Ut(this,t).set(t,e),this},Pt.prototype.clear=function(){this.__data__=new _t},Pt.prototype.delete=function(t){return this.__data__.delete(t)},Pt.prototype.get=function(t){return this.__data__.get(t)},Pt.prototype.has=function(t){return this.__data__.has(t)},Pt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof _t){var r=n.__data__;if(!pt||r.length<199)return r.push([t,e]),this;n=this.__data__=new Tt(r)}return n.set(t,e),this};var Dt=ht?W(ht,Object):function(){return[]},$t=function(t){return et.call(t)};function Lt(t,e){return!!(e=null==e?i:e)&&("number"==typeof t||O.test(t))&&t>-1&&t%1==0&&t<e}function Kt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Z)}function Mt(t){if(null!=t){try{return Q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function jt(t,e){return t===e||t!=t&&e!=e}(lt&&$t(new lt(new ArrayBuffer(1)))!=m||pt&&$t(new pt)!=h||gt&&$t(gt.resolve())!=l||yt&&$t(new yt)!=g||wt&&$t(new wt)!=b)&&($t=function(t){var e=et.call(t),n=e==f?t.constructor:void 0,r=n?Mt(n):void 0;if(r)switch(r){case At:return m;case mt:return h;case Et:return l;case St:return g;case vt:return b}return e});var Gt=Array.isArray;function Ft(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!Vt(t)}var Wt=dt||function(){return!1};function Vt(t){var e=qt(t)?et.call(t):"";return e==c||e==u}function qt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function zt(t){return Ft(t)?function(t,e){var n=Gt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Ft(t)}(t)&&tt.call(t,"callee")&&(!ct.call(t,"callee")||et.call(t)==o)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],r=n.length,i=!!r;for(var s in t)!e&&!tt.call(t,s)||i&&("length"==s||Lt(s,r))||n.push(s);return n}(t):function(t){if(!Kt(t))return ft(t);var e=[];for(var n in Object(t))tt.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return Ot(t,!0,!0)}},314:()=>{}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var o=r[t]={id:t,loaded:!1,exports:{}};return n[t](o,o.exports,i),o.loaded=!0,o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);i.r(o);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>n[t]));return s.default=()=>n,i.d(o,s),o},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var o={};return(()=>{"use strict";function t(t,n){return c(e(t),n)}function e(t){if("bigint"==typeof t)return t;if("string"==typeof t)return BigInt(t);if("number"==typeof t){if(!Number.isInteger(t))throw new RangeError("Invalid value. Values of type 'number' must be an integer.");if(t>Number.MAX_SAFE_INTEGER)throw new RangeError(`Invalid value. Values of type 'number' must be less than or equal to ${Number.MAX_SAFE_INTEGER}. For larger values, try using a BigInt instead.`);return BigInt(t)}if(E(t,Uint8Array))return BigInt(`0x${d(t)}`);throw new TypeError("intToBigInt: Invalid value type. Must be a number, bigint, BigInt-compatible string, or Uint8Array.")}function n(t){return/^0x/i.test(t)?t.slice(2):t}function r(t){if("string"!=typeof t)throw new TypeError("hexToBigInt: expected string, got "+typeof t);return BigInt(`0x${t}`)}function s(t,n=8){return("bigint"==typeof t?t:e(t)).toString(16).padStart(2*n,"0")}function a(t){return parseInt(t,16)}function c(t,e=16){return f(s(t,e))}function u(t){return e=BigInt(`0x${d(t)}`),n=BigInt(8*t.byteLength),function(t,e){return t&BigInt(1)<<e}(e,n-BigInt(1))?e-(BigInt(1)<<n):e;var e,n}i.r(o),i.d(o,{InvalidAddressError:()=>$o,Pox4SignatureTopic:()=>Yo,StackingClient:()=>us,btcAddressVersionToLegacyHashMode:()=>Lo,decodeBtcAddress:()=>Ko,decodeBtcAddressBytes:()=>Mo,ensureLegacyBtcAddressForPox1:()=>Zo,ensurePox2Activated:()=>Xo,ensureSignerArgsReadiness:()=>Jo,extractPoxAddressFromClarityValue:()=>jo,getErrorString:()=>Go,pox4SignatureMessage:()=>es,poxAddressToBtcAddress:()=>Vo,poxAddressToTuple:()=>Fo,signPox4SignatureHash:()=>Qo,unwrap:()=>qo,unwrapMap:()=>zo,verifyPox4SignatureHash:()=>ts});const h=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function d(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(const n of t)e+=h[n];return e}function f(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);t=(t=n(t)).length%2?`0${t}`:t;const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=2*n,i=t.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[n]=o}return e}function l(t){return(new TextEncoder).encode(t)}function p(t){return(new TextDecoder).decode(t)}function g(t){const e=[];for(let n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return new Uint8Array(e)}function y(t){return String.fromCharCode.apply(null,t)}function w(t){return!Number.isInteger(t)||t<0||t>255}function b(t){if(t.some(w))throw new Error("Some values are invalid bytes.");return new Uint8Array(t)}function A(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}function m(t){return A(...t.map((t=>"number"==typeof t?b([t]):t instanceof Array?b(t):t)))}function E(t,e){return t instanceof e||t?.constructor?.name?.toLowerCase()===e.name}const S=33,v={referrerPolicy:"origin",headers:{"x-hiro-product":"stacksjs"}};async function x(t,e){const n={};return Object.assign(n,v,e),await fetch(t,n)}function I(...t){const{fetchLib:e,middlewares:n}=function(t){let e=x,n=[];return t.length>0&&"function"==typeof t[0]&&(e=t.shift()),t.length>0&&(n=t),{fetchLib:e,middlewares:n}}(t);return async(t,r)=>{let i={url:t,init:r??{}};for(const t of n)"function"==typeof t.pre&&(i=await Promise.resolve(t.pre({fetch:e,...i}))??i);let o=await e(i.url,i.init);for(const t of n)if("function"==typeof t.post){const n=await Promise.resolve(t.post({fetch:e,url:i.url,init:i.init,response:o?.clone()??o}));o=n??o}return o}}var C,_,T,P,k;!function(t){t[t.Mainnet=1]="Mainnet",t[t.Testnet=2147483648]="Testnet"}(C||(C={})),function(t){t[t.Mainnet=385875968]="Mainnet",t[t.Testnet=4278190080]="Testnet"}(_||(_={})),C.Mainnet,(k=T||(T={}))[k.Mainnet=0]="Mainnet",k[k.Testnet=128]="Testnet",function(t){t[t.MainnetSingleSig=22]="MainnetSingleSig",t[t.MainnetMultiSig=20]="MainnetMultiSig",t[t.TestnetSingleSig=26]="TestnetSingleSig",t[t.TestnetMultiSig=21]="TestnetMultiSig"}(P||(P={})),T.Mainnet;const R={chainId:C.Mainnet,transactionVersion:T.Mainnet,peerNetworkId:_.Mainnet,magicBytes:"X2",bootAddress:"SP000000000000000000002Q6VF78",addressVersion:{singleSig:P.MainnetSingleSig,multiSig:P.MainnetMultiSig},client:{baseUrl:"https://api.mainnet.hiro.so"}},O={chainId:C.Testnet,transactionVersion:T.Testnet,peerNetworkId:_.Testnet,magicBytes:"T2",bootAddress:"ST000000000000000000002AMW42H",addressVersion:{singleSig:P.TestnetSingleSig,multiSig:P.TestnetMultiSig},client:{baseUrl:"https://api.testnet.hiro.so"}},B={...O,addressVersion:{...O.addressVersion},magicBytes:"id",client:{baseUrl:"http://localhost:3999"}},N={...B,addressVersion:{...B.addressVersion},client:{...B.client}},U=["mainnet","testnet","devnet","mocknet"];function H(t){return"string"==typeof t?function(t){switch(t){case"mainnet":return R;case"testnet":return O;case"devnet":return B;case"mocknet":return N;default:throw new Error(`Unknown network name: ${t}`)}}(t):t}function D(t){return t.client.fetch?t.client:{...t.client,fetch:I()}}class $ extends Error{constructor(t){super(t),this.message=t,this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class L extends ${constructor(t){super(t)}}class K extends ${constructor(t){super(t)}}class M extends ${constructor(t){super(t)}}class j extends ${constructor(t){super(t)}}class G extends ${constructor(t){super(t)}}function F(t,e){return t[e]}function W(t,e,n=0){return t[n]=e,t}function V(t,e,n=0){return t[n+3]=e,e>>>=8,t[n+2]=e,e>>>=8,t[n+1]=e,e>>>=8,t[n]=e,t}function q(t,e,n=0){return t[n+0]=255&e,e>>>=8,t[n+1]=255&e,e>>>=8,t[n+2]=255&e,e>>>=8,t[n+3]=255&e,t}const z=new Map;function X(t,e){const n=z.get(t);if(void 0!==n)return n(e);const r=function(t){const e=Object.values(t).filter((t=>"number"==typeof t)),n=new Set(e);return t=>n.has(t)}(t);return z.set(t,r),X(t,e)}class Z{constructor(t){this.consumed=0,this.source="string"==typeof t?f(t):t}readBytes(t){const e=this.source.subarray(this.consumed,this.consumed+t);return this.consumed+=t,e}readUInt32BE(){return(t=this.readBytes(4))[0]*2**24+65536*t[1]+256*t[2]+t[3];var t}readUInt8(){return F(this.readBytes(1),0)}readUInt16BE(){return((t=this.readBytes(2))[0+0]<<8|t[1])>>>0;var t}readBigUIntLE(t){const e=d(this.readBytes(t).slice().reverse());return BigInt(`0x${e}`)}readBigUIntBE(t){const e=d(this.readBytes(t));return BigInt(`0x${e}`)}get readOffset(){return this.consumed}set readOffset(t){this.consumed=t}get internalBytes(){return this.source}readUInt8Enum(t,e){const n=this.readUInt8();if(X(t,n))return n;throw e(n)}}const J=128,Y=128,Q=16,tt=65,et=34;var nt,rt,it,ot,st,at;(at=nt||(nt={}))[at.TokenTransfer=0]="TokenTransfer",at[at.SmartContract=1]="SmartContract",at[at.VersionedSmartContract=6]="VersionedSmartContract",at[at.ContractCall=2]="ContractCall",at[at.PoisonMicroblock=3]="PoisonMicroblock",at[at.Coinbase=4]="Coinbase",at[at.CoinbaseToAltRecipient=5]="CoinbaseToAltRecipient",at[at.TenureChange=7]="TenureChange",at[at.NakamotoCoinbase=8]="NakamotoCoinbase",(st=rt||(rt={}))[st.Clarity1=1]="Clarity1",st[st.Clarity2=2]="Clarity2",st[st.Clarity3=3]="Clarity3",(ot=it||(it={}))[ot.OnChainOnly=1]="OnChainOnly",ot[ot.OffChainOnly=2]="OffChainOnly",ot[ot.Any=3]="Any";var ct,ut,ht,dt,ft,lt,pt,gt,yt,wt,bt,At,mt,Et,St,vt,xt,It,Ct,_t,Tt,Pt;function kt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Rt(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}it.OnChainOnly,it.OffChainOnly,it.Any,it.OnChainOnly,it.OnChainOnly,it.OffChainOnly,it.OffChainOnly,it.Any,it.Any,(Pt=ct||(ct={}))[Pt.Allow=1]="Allow",Pt[Pt.Deny=2]="Deny",(Tt=ut||(ut={}))[Tt.STX=0]="STX",Tt[Tt.Fungible=1]="Fungible",Tt[Tt.NonFungible=2]="NonFungible",(_t=ht||(ht={}))[_t.Standard=4]="Standard",_t[_t.Sponsored=5]="Sponsored",(Ct=dt||(dt={}))[Ct.P2PKH=0]="P2PKH",Ct[Ct.P2SH=1]="P2SH",Ct[Ct.P2WPKH=2]="P2WPKH",Ct[Ct.P2WSH=3]="P2WSH",Ct[Ct.P2SHNonSequential=5]="P2SHNonSequential",Ct[Ct.P2WSHNonSequential=7]="P2WSHNonSequential",(It=ft||(ft={}))[It.Compressed=0]="Compressed",It[It.Uncompressed=1]="Uncompressed",(xt=lt||(lt={}))[xt.Equal=1]="Equal",xt[xt.Greater=2]="Greater",xt[xt.GreaterEqual=3]="GreaterEqual",xt[xt.Less=4]="Less",xt[xt.LessEqual=5]="LessEqual",(vt=pt||(pt={}))[vt.Sends=16]="Sends",vt[vt.DoesNotSend=17]="DoesNotSend",(St=gt||(gt={}))[St.Origin=1]="Origin",St[St.Standard=2]="Standard",St[St.Contract=3]="Contract",function(t){t[t.STX=0]="STX",t[t.Fungible=1]="Fungible",t[t.NonFungible=2]="NonFungible"}(yt||(yt={})),(Et=wt||(wt={}))[Et.BlockFound=0]="BlockFound",Et[Et.Extended=1]="Extended",(mt=bt||(bt={}))[mt.PublicKeyCompressed=0]="PublicKeyCompressed",mt[mt.PublicKeyUncompressed=1]="PublicKeyUncompressed",mt[mt.SignatureCompressed=2]="SignatureCompressed",mt[mt.SignatureUncompressed=3]="SignatureUncompressed",function(t){t.Serialization="Serialization",t.Deserialization="Deserialization",t.SignatureValidation="SignatureValidation",t.FeeTooLow="FeeTooLow",t.BadNonce="BadNonce",t.NotEnoughFunds="NotEnoughFunds",t.NoSuchContract="NoSuchContract",t.NoSuchPublicFunction="NoSuchPublicFunction",t.BadFunctionArgument="BadFunctionArgument",t.ContractAlreadyExists="ContractAlreadyExists",t.PoisonMicroblocksDoNotConflict="PoisonMicroblocksDoNotConflict",t.PoisonMicroblockHasUnknownPubKeyHash="PoisonMicroblockHasUnknownPubKeyHash",t.PoisonMicroblockIsInvalid="PoisonMicroblockIsInvalid",t.BadAddressVersionByte="BadAddressVersionByte",t.NoCoinbaseViaMempool="NoCoinbaseViaMempool",t.ServerFailureNoSuchChainTip="ServerFailureNoSuchChainTip",t.ServerFailureDatabase="ServerFailureDatabase",t.ServerFailureOther="ServerFailureOther"}(At||(At={}));const Ot={number:kt,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:Rt,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");kt(t.outputLen),kt(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){Rt(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},Bt=("object"==typeof self&&"crypto"in self&&self.crypto,t=>new DataView(t.buffer,t.byteOffset,t.byteLength)),Nt=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function Ut(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new TypeError("utf8ToBytes expected string, got "+typeof t);return(new TextEncoder).encode(t)}(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));class Ht{clone(){return this._cloneInto()}}function Dt(t){const e=e=>t().update(Ut(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}class $t extends Ht{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Bt(this.buffer)}update(t){Ot.exists(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=Ut(t)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(t.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Bt(t);for(;r<=i-o;o+=r)this.process(e,o)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ot.exists(this),Ot.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let t=o;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,u=r?0:4;t.setUint32(e+c,s,r),t.setUint32(e+u,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Bt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)s.setUint32(4*t,u[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return t.length=r,t.pos=s,t.finished=i,t.destroyed=o,r%e&&t.buffer.set(n),t}}const Lt=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Kt=Uint8Array.from({length:16},((t,e)=>e)),Mt=Kt.map((t=>(9*t+5)%16));let jt=[Kt],Gt=[Mt];for(let t=0;t<4;t++)for(let e of[jt,Gt])e.push(e[t].map((t=>Lt[t])));const Ft=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((t=>new Uint8Array(t))),Wt=jt.map(((t,e)=>t.map((t=>Ft[e][t])))),Vt=Gt.map(((t,e)=>t.map((t=>Ft[e][t])))),qt=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),zt=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),Xt=(t,e)=>t<<e|t>>>32-e;function Zt(t,e,n,r){return 0===t?e^n^r:1===t?e&n|~e&r:2===t?(e|~n)^r:3===t?e&r|n&~r:e^(n|~r)}const Jt=new Uint32Array(16);class Yt extends $t{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:e,h2:n,h3:r,h4:i}=this;return[t,e,n,r,i]}set(t,e,n,r,i){this.h0=0|t,this.h1=0|e,this.h2=0|n,this.h3=0|r,this.h4=0|i}process(t,e){for(let n=0;n<16;n++,e+=4)Jt[n]=t.getUint32(e,!0);let n=0|this.h0,r=n,i=0|this.h1,o=i,s=0|this.h2,a=s,c=0|this.h3,u=c,h=0|this.h4,d=h;for(let t=0;t<5;t++){const e=4-t,f=qt[t],l=zt[t],p=jt[t],g=Gt[t],y=Wt[t],w=Vt[t];for(let e=0;e<16;e++){const r=Xt(n+Zt(t,i,s,c)+Jt[p[e]]+f,y[e])+h|0;n=h,h=c,c=0|Xt(s,10),s=i,i=r}for(let t=0;t<16;t++){const n=Xt(r+Zt(e,o,a,u)+Jt[g[t]]+l,w[t])+d|0;r=d,d=u,u=0|Xt(a,10),a=o,o=n}}this.set(this.h1+s+u|0,this.h2+c+d|0,this.h3+h+r|0,this.h4+n+o|0,this.h0+i+a|0)}roundClean(){Jt.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const Qt=Dt((()=>new Yt)),te=(t,e,n)=>t&e^t&n^e&n,ee=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ne=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),re=new Uint32Array(64);class ie extends $t{constructor(){super(64,32,8,!1),this.A=0|ne[0],this.B=0|ne[1],this.C=0|ne[2],this.D=0|ne[3],this.E=0|ne[4],this.F=0|ne[5],this.G=0|ne[6],this.H=0|ne[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[t,e,n,r,i,o,s,a]}set(t,e,n,r,i,o,s,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)re[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=re[t-15],n=re[t-2],r=Nt(e,7)^Nt(e,18)^e>>>3,i=Nt(n,17)^Nt(n,19)^n>>>10;re[t]=i+re[t-7]+r+re[t-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:u}=this;for(let t=0;t<64;t++){const e=u+(Nt(s,6)^Nt(s,11)^Nt(s,25))+((h=s)&a^~h&c)+ee[t]+re[t]|0,d=(Nt(n,2)^Nt(n,13)^Nt(n,22))+te(n,r,i)|0;u=c,c=a,a=s,s=o+e|0,o=i,i=r,r=n,n=e+d|0}var h;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,o,s,a,c,u)}roundClean(){re.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class oe extends ie{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const se=Dt((()=>new ie)),ae=(Dt((()=>new oe)),BigInt(2**32-1)),ce=BigInt(32);function ue(t,e=!1){return e?{h:Number(t&ae),l:Number(t>>ce&ae)}:{h:0|Number(t>>ce&ae),l:0|Number(t&ae)}}const he=function(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:o,l:s}=ue(t[i],e);[n[i],r[i]]=[o,s]}return[n,r]},de=(t,e,n)=>t>>>n,fe=(t,e,n)=>t<<32-n|e>>>n,le=(t,e,n)=>t>>>n|e<<32-n,pe=(t,e,n)=>t<<32-n|e>>>n,ge=(t,e,n)=>t<<64-n|e>>>n-32,ye=(t,e,n)=>t>>>n-32|e<<64-n,we=function(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:0|i}},be=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Ae=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,me=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),Ee=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,Se=(t,e,n,r,i,o)=>e+n+r+i+o+(t/2**32|0)|0,ve=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),[xe,Ie]=he(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))),Ce=new Uint32Array(80),_e=new Uint32Array(80);class Te extends $t{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:c,El:u,Fh:h,Fl:d,Gh:f,Gl:l,Hh:p,Hl:g}=this;return[t,e,n,r,i,o,s,a,c,u,h,d,f,l,p,g]}set(t,e,n,r,i,o,s,a,c,u,h,d,f,l,p,g){this.Ah=0|t,this.Al=0|e,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|h,this.Fl=0|d,this.Gh=0|f,this.Gl=0|l,this.Hh=0|p,this.Hl=0|g}process(t,e){for(let n=0;n<16;n++,e+=4)Ce[n]=t.getUint32(e),_e[n]=t.getUint32(e+=4);for(let t=16;t<80;t++){const e=0|Ce[t-15],n=0|_e[t-15],r=le(e,n,1)^le(e,n,8)^de(e,n,7),i=pe(e,n,1)^pe(e,n,8)^fe(e,n,7),o=0|Ce[t-2],s=0|_e[t-2],a=le(o,s,19)^ge(o,s,61)^de(o,s,6),c=pe(o,s,19)^ye(o,s,61)^fe(o,s,6),u=me(i,c,_e[t-7],_e[t-16]),h=Ee(u,r,a,Ce[t-7],Ce[t-16]);Ce[t]=0|h,_e[t]=0|u}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:c,Dl:u,Eh:h,El:d,Fh:f,Fl:l,Gh:p,Gl:g,Hh:y,Hl:w}=this;for(let t=0;t<80;t++){const e=le(h,d,14)^le(h,d,18)^ge(h,d,41),b=pe(h,d,14)^pe(h,d,18)^ye(h,d,41),A=h&f^~h&p,m=ve(w,b,d&l^~d&g,Ie[t],_e[t]),E=Se(m,y,e,A,xe[t],Ce[t]),S=0|m,v=le(n,r,28)^ge(n,r,34)^ge(n,r,39),x=pe(n,r,28)^ye(n,r,34)^ye(n,r,39),I=n&i^n&s^i&s,C=r&o^r&a^o&a;y=0|p,w=0|g,p=0|f,g=0|l,f=0|h,l=0|d,({h,l:d}=we(0|c,0|u,0|E,0|S)),c=0|s,u=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const _=be(S,x,C);n=Ae(_,E,v,I),r=0|_}({h:n,l:r}=we(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=we(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=we(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:u}=we(0|this.Dh,0|this.Dl,0|c,0|u)),({h,l:d}=we(0|this.Eh,0|this.El,0|h,0|d)),({h:f,l}=we(0|this.Fh,0|this.Fl,0|f,0|l)),({h:p,l:g}=we(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:w}=we(0|this.Hh,0|this.Hl,0|y,0|w)),this.set(n,r,i,o,s,a,c,u,h,d,f,l,p,g,y,w)}roundClean(){Ce.fill(0),_e.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Pe extends Te{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class ke extends Te{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Re extends Te{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}Dt((()=>new Te)),Dt((()=>new Pe));const Oe=Dt((()=>new ke));Dt((()=>new Re));var Be=i(314),Ne=i.t(Be,2);const Ue=BigInt(0),He=BigInt(1),De=BigInt(2),$e=BigInt(3),Le=BigInt(8),Ke=Object.freeze({a:Ue,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:He,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),Me=(t,e)=>(t+e/De)/e,je={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(t){const{n:e}=Ke,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-He*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=Me(o*t,e),c=Me(-r*t,e);let u=bn(t-a*n-c*i,e),h=bn(-a*r-c*o,e);const d=u>s,f=h>s;if(d&&(u=e-u),f&&(h=e-h),u>s||h>s)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:d,k1:u,k2neg:f,k2:h}}},Ge=32,Fe=32,We=32,Ve=Ge+1,qe=2*Ge+1;function ze(t){const{a:e,b:n}=Ke,r=bn(t*t),i=bn(r*t);return bn(i+e*t+n)}const Xe=Ke.a===Ue;class Ze extends Error{constructor(t){super(t)}}function Je(t){if(!(t instanceof Ye))throw new TypeError("JacobianPoint expected")}class Ye{constructor(t,e,n){this.x=t,this.y=e,this.z=n}static fromAffine(t){if(!(t instanceof en))throw new TypeError("JacobianPoint#fromAffine: expected Point");return t.equals(en.ZERO)?Ye.ZERO:new Ye(t.x,t.y,He)}static toAffineBatch(t){const e=function(t,e=Ke.P){const n=new Array(t.length),r=mn(t.reduce(((t,r,i)=>r===Ue?t:(n[i]=t,bn(t*r,e))),He),e);return t.reduceRight(((t,r,i)=>r===Ue?t:(n[i]=bn(t*n[i],e),bn(t*r,e))),r),n}(t.map((t=>t.z)));return t.map(((t,n)=>t.toAffine(e[n])))}static normalizeZ(t){return Ye.toAffineBatch(t).map(Ye.fromAffine)}equals(t){Je(t);const{x:e,y:n,z:r}=this,{x:i,y:o,z:s}=t,a=bn(r*r),c=bn(s*s),u=bn(e*c),h=bn(i*a),d=bn(bn(n*s)*c),f=bn(bn(o*r)*a);return u===h&&d===f}negate(){return new Ye(this.x,bn(-this.y),this.z)}double(){const{x:t,y:e,z:n}=this,r=bn(t*t),i=bn(e*e),o=bn(i*i),s=t+i,a=bn(De*(bn(s*s)-r-o)),c=bn($e*r),u=bn(c*c),h=bn(u-De*a),d=bn(c*(a-h)-Le*o),f=bn(De*e*n);return new Ye(h,d,f)}add(t){Je(t);const{x:e,y:n,z:r}=this,{x:i,y:o,z:s}=t;if(i===Ue||o===Ue)return this;if(e===Ue||n===Ue)return t;const a=bn(r*r),c=bn(s*s),u=bn(e*c),h=bn(i*a),d=bn(bn(n*s)*c),f=bn(bn(o*r)*a),l=bn(h-u),p=bn(f-d);if(l===Ue)return p===Ue?this.double():Ye.ZERO;const g=bn(l*l),y=bn(l*g),w=bn(u*g),b=bn(p*p-y-De*w),A=bn(p*(w-b)-d*y),m=bn(r*s*l);return new Ye(b,A,m)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=Ye.ZERO;if("bigint"==typeof t&&t===Ue)return e;let n=wn(t);if(n===He)return this;if(!Xe){let t=e,r=this;for(;n>Ue;)n&He&&(t=t.add(r)),r=r.double(),n>>=He;return t}let{k1neg:r,k1:i,k2neg:o,k2:s}=je.splitScalar(n),a=e,c=e,u=this;for(;i>Ue||s>Ue;)i&He&&(a=a.add(u)),s&He&&(c=c.add(u)),u=u.double(),i>>=He,s>>=He;return r&&(a=a.negate()),o&&(c=c.negate()),c=new Ye(bn(c.x*je.beta),c.y,c.z),a.add(c)}precomputeWindow(t){const e=Xe?128/t+1:256/t+1,n=[];let r=this,i=r;for(let o=0;o<e;o++){i=r,n.push(i);for(let e=1;e<2**(t-1);e++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(t,e){!e&&this.equals(Ye.BASE)&&(e=en.BASE);const n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&tn.get(e);r||(r=this.precomputeWindow(n),e&&1!==n&&(r=Ye.normalizeZ(r),tn.set(e,r)));let i=Ye.ZERO,o=Ye.BASE;const s=1+(Xe?128/n:256/n),a=2**(n-1),c=BigInt(2**n-1),u=2**n,h=BigInt(n);for(let e=0;e<s;e++){const n=e*a;let s=Number(t&c);t>>=h,s>a&&(s-=u,t+=He);const d=n,f=n+Math.abs(s)-1,l=e%2!=0,p=s<0;0===s?o=o.add(Qe(l,r[d])):i=i.add(Qe(p,r[f]))}return{p:i,f:o}}multiply(t,e){let n,r,i=wn(t);if(Xe){const{k1neg:t,k1:o,k2neg:s,k2:a}=je.splitScalar(i);let{p:c,f:u}=this.wNAF(o,e),{p:h,f:d}=this.wNAF(a,e);c=Qe(t,c),h=Qe(s,h),h=new Ye(bn(h.x*je.beta),h.y,h.z),n=c.add(h),r=u.add(d)}else{const{p:t,f:o}=this.wNAF(i,e);n=t,r=o}return Ye.normalizeZ([n,r])[0]}toAffine(t){const{x:e,y:n,z:r}=this,i=this.equals(Ye.ZERO);null==t&&(t=i?Le:mn(r));const o=t,s=bn(o*o),a=bn(s*o),c=bn(e*s),u=bn(n*a),h=bn(r*o);if(i)return en.ZERO;if(h!==He)throw new Error("invZ was invalid");return new en(c,u)}}function Qe(t,e){const n=e.negate();return t?n:e}Ye.BASE=new Ye(Ke.Gx,Ke.Gy,He),Ye.ZERO=new Ye(Ue,He,Ue);const tn=new WeakMap;class en{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,tn.delete(this)}hasEvenY(){return this.y%De===Ue}static fromCompressedHex(t){const e=32===t.length,n=gn(e?t:t.subarray(1));if(!Cn(n))throw new Error("Point is not on curve");let r=function(t){const{P:e}=Ke,n=BigInt(6),r=BigInt(11),i=BigInt(22),o=BigInt(23),s=BigInt(44),a=BigInt(88),c=t*t*t%e,u=c*c*t%e,h=An(u,$e)*u%e,d=An(h,$e)*u%e,f=An(d,De)*c%e,l=An(f,r)*f%e,p=An(l,i)*l%e,g=An(p,s)*p%e,y=An(g,a)*g%e,w=An(y,s)*p%e,b=An(w,$e)*u%e,A=An(b,o)*l%e,m=An(A,n)*c%e,E=An(m,De);if(E*E%e!==t)throw new Error("Cannot find square root");return E}(ze(n));const i=(r&He)===He;e?i&&(r=bn(-r)):1==(1&t[0])!==i&&(r=bn(-r));const o=new en(n,r);return o.assertValidity(),o}static fromUncompressedHex(t){const e=gn(t.subarray(1,Ge+1)),n=gn(t.subarray(Ge+1,2*Ge+1)),r=new en(e,n);return r.assertValidity(),r}static fromHex(t){const e=yn(t),n=e.length,r=e[0];if(n===Ge)return this.fromCompressedHex(e);if(n===Ve&&(2===r||3===r))return this.fromCompressedHex(e);if(n===qe&&4===r)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-${Ve} compressed bytes or ${qe} uncompressed bytes, not ${n}`)}static fromPrivateKey(t){return en.BASE.multiply(Tn(t))}static fromSignature(t,e,n){const{r,s:i}=Pn(e);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");const o=En(yn(t)),{n:s}=Ke,a=2===n||3===n?r+s:r,c=mn(a,s),u=bn(-o*c,s),h=bn(i*c,s),d=1&n?"03":"02",f=en.fromHex(d+hn(a)),l=en.BASE.multiplyAndAddUnsafe(f,u,h);if(!l)throw new Error("Cannot recover signature: point at infinify");return l.assertValidity(),l}toRawBytes(t=!1){return pn(this.toHex(t))}toHex(t=!1){const e=hn(this.x);return t?`${this.hasEvenY()?"02":"03"}${e}`:`04${e}${hn(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:n}=this;if(!Cn(e)||!Cn(n))throw new Error(t);const r=bn(n*n);if(bn(r-ze(e))!==Ue)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new en(this.x,bn(-this.y))}double(){return Ye.fromAffine(this).double().toAffine()}add(t){return Ye.fromAffine(this).add(Ye.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return Ye.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,n){const r=Ye.fromAffine(this),i=e===Ue||e===He||this!==en.BASE?r.multiplyUnsafe(e):r.multiply(e),o=Ye.fromAffine(t).multiplyUnsafe(n),s=i.add(o);return s.equals(Ye.ZERO)?void 0:s.toAffine()}}function nn(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function rn(t){if(t.length<2||2!==t[0])throw new Error(`Invalid signature integer tag: ${cn(t)}`);const e=t[1],n=t.subarray(2,e+2);if(!e||n.length!==e)throw new Error("Invalid signature integer: wrong length");if(0===n[0]&&n[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:gn(n),left:t.subarray(e+2)}}en.BASE=new en(Ke.Gx,Ke.Gy),en.ZERO=new en(Ue,Ue);class on{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=t instanceof Uint8Array,n="Signature.fromCompact";if("string"!=typeof t&&!e)throw new TypeError(`${n}: Expected string or Uint8Array`);const r=e?cn(t):t;if(128!==r.length)throw new Error(`${n}: Expected 64-byte hex`);return new on(ln(r.slice(0,64)),ln(r.slice(64,128)))}static fromDER(t){const e=t instanceof Uint8Array;if("string"!=typeof t&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:n,s:r}=function(t){if(t.length<2||48!=t[0])throw new Error(`Invalid signature tag: ${cn(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:n}=rn(t.subarray(2)),{data:r,left:i}=rn(n);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${cn(i)}`);return{r:e,s:r}}(e?t:pn(t));return new on(n,r)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!In(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!In(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=Ke.n>>He;return this.s>t}normalizeS(){return this.hasHighS()?new on(this.r,bn(-this.s,Ke.n)):this}toDERRawBytes(){return pn(this.toDERHex())}toDERHex(){const t=nn(fn(this.s)),e=nn(fn(this.r)),n=t.length/2,r=e.length/2,i=fn(n),o=fn(r);return`30${fn(r+n+4)}02${o}${e}02${i}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return pn(this.toCompactHex())}toCompactHex(){return hn(this.r)+hn(this.s)}}function sn(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}const an=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function cn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let n=0;n<t.length;n++)e+=an[t[n]];return e}const un=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function hn(t){if("bigint"!=typeof t)throw new Error("Expected bigint");if(!(Ue<=t&&t<un))throw new Error("Expected number 0 <= n < 2^256");return t.toString(16).padStart(64,"0")}function dn(t){const e=pn(hn(t));if(32!==e.length)throw new Error("Error: expected 32 bytes");return e}function fn(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function ln(t){if("string"!=typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function pn(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=2*n,i=t.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[n]=o}return e}function gn(t){return ln(cn(t))}function yn(t){return t instanceof Uint8Array?Uint8Array.from(t):pn(t)}function wn(t){if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if("bigint"==typeof t&&In(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function bn(t,e=Ke.P){const n=t%e;return n>=Ue?n:e+n}function An(t,e){const{P:n}=Ke;let r=t;for(;e-- >Ue;)r*=r,r%=n;return r}function mn(t,e=Ke.P){if(t===Ue||e<=Ue)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=bn(t,e),r=e,i=Ue,o=He,s=He,a=Ue;for(;n!==Ue;){const t=r/n,e=r%n,c=i-s*t,u=o-a*t;r=n,n=e,i=s,o=a,s=c,a=u}if(r!==He)throw new Error("invert: does not exist");return bn(i,e)}function En(t,e=!1){const n=function(t){const e=8*t.length-8*Fe,n=gn(t);return e>0?n>>BigInt(e):n}(t);if(e)return n;const{n:r}=Ke;return n>=r?n-r:n}let Sn,vn;class xn{constructor(t,e){if(this.hashLen=t,this.qByteLen=e,"number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(t).fill(1),this.k=new Uint8Array(t).fill(0),this.counter=0}hmac(...t){return Dn.hmacSha256(this.k,...t)}hmacSync(...t){return vn(this.k,...t)}checkSync(){if("function"!=typeof vn)throw new Ze("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(t=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),t),this.v=await this.hmac(this.v),0!==t.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),t),this.v=await this.hmac(this.v))}reseedSync(t=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),t),this.v=this.hmacSync(this.v),0!==t.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),t),this.v=this.hmacSync(this.v))}async generate(){this.incr();let t=0;const e=[];for(;t<this.qByteLen;){this.v=await this.hmac(this.v);const n=this.v.slice();e.push(n),t+=this.v.length}return sn(...e)}generateSync(){this.checkSync(),this.incr();let t=0;const e=[];for(;t<this.qByteLen;){this.v=this.hmacSync(this.v);const n=this.v.slice();e.push(n),t+=this.v.length}return sn(...e)}}function In(t){return Ue<t&&t<Ke.n}function Cn(t){return Ue<t&&t<Ke.P}function _n(t,e,n,r=!0){const{n:i}=Ke,o=En(t,!0);if(!In(o))return;const s=mn(o,i),a=en.BASE.multiply(o),c=bn(a.x,i);if(c===Ue)return;const u=bn(s*bn(e+n*c,i),i);if(u===Ue)return;let h=new on(c,u),d=(a.x===h.r?0:2)|Number(a.y&He);return r&&h.hasHighS()&&(h=h.normalizeS(),d^=1),{sig:h,recovery:d}}function Tn(t){let e;if("bigint"==typeof t)e=t;else if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if("string"==typeof t){if(t.length!==2*Fe)throw new Error("Expected 32 bytes of private key");e=ln(t)}else{if(!(t instanceof Uint8Array))throw new TypeError("Expected valid private key");if(t.length!==Fe)throw new Error("Expected 32 bytes of private key");e=gn(t)}if(!In(e))throw new Error("Expected private key: 0 < key < n");return e}function Pn(t){if(t instanceof on)return t.assertValidity(),t;try{return on.fromDER(t)}catch(e){return on.fromCompact(t)}}function kn(t){return gn(t.length>Ge?t.slice(0,Ge):t)}function Rn(t){const e=kn(t),n=bn(e,Ke.n);return On(n<Ue?e:n)}function On(t){return dn(t)}const Bn={strict:!0};function Nn(t,e,n,r=Bn){let i;try{i=Pn(t),e=yn(e)}catch(t){return!1}const{r:o,s}=i;if(r.strict&&i.hasHighS())return!1;const a=En(e);let c;try{c=function(t){return t instanceof en?(t.assertValidity(),t):en.fromHex(t)}(n)}catch(t){return!1}const{n:u}=Ke,h=mn(s,u),d=bn(a*h,u),f=bn(o*h,u),l=en.BASE.multiplyAndAddUnsafe(c,d,f);return!!l&&bn(l.x,u)===o}en.BASE._setWindowSize(8);const Un={node:Ne,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},Hn={},Dn={bytesToHex:cn,hexToBytes:pn,concatBytes:sn,mod:bn,invert:mn,isValidPrivateKey(t){try{return Tn(t),!0}catch(t){return!1}},_bigintTo32Bytes:dn,_normalizePrivateKey:Tn,hashToPrivateKey:t=>{t=yn(t);const e=Fe+8;if(t.length<e||t.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");return dn(bn(gn(t),Ke.n-He)+He)},randomBytes:(t=32)=>{if(Un.web)return Un.web.getRandomValues(new Uint8Array(t));if(Un.node){const{randomBytes:e}=Un.node;return Uint8Array.from(e(t))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Dn.hashToPrivateKey(Dn.randomBytes(Fe+8)),precompute(t=8,e=en.BASE){const n=e===en.BASE?e:new en(e.x,e.y);return n._setWindowSize(t),n.multiply($e),n},sha256:async(...t)=>{if(Un.web){const e=await Un.web.subtle.digest("SHA-256",sn(...t));return new Uint8Array(e)}if(Un.node){const{createHash:e}=Un.node,n=e("sha256");return t.forEach((t=>n.update(t))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(Un.web){const n=await Un.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=sn(...e),i=await Un.web.subtle.sign("HMAC",n,r);return new Uint8Array(i)}if(Un.node){const{createHmac:n}=Un.node,r=n("sha256",t);return e.forEach((t=>r.update(t))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let n=Hn[t];if(void 0===n){const e=await Dn.sha256(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=sn(e,e),Hn[t]=n}return Dn.sha256(n,...e)},taggedHashSync:(t,...e)=>{if("function"!=typeof Sn)throw new Ze("sha256Sync is undefined, you need to set it");let n=Hn[t];if(void 0===n){const e=Sn(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=sn(e,e),Hn[t]=n}return Sn(n,...e)},_JacobianPoint:Ye};Object.defineProperties(Dn,{sha256Sync:{configurable:!1,get:()=>Sn,set(t){Sn||(Sn=t)}},hmacSha256Sync:{configurable:!1,get:()=>vn,set(t){vn||(vn=t)}}});var $n,Ln,Kn,Mn=i(870),jn=i(907),Gn=i.n(jn);function Fn(t){return Ln[t]}(Kn=$n||($n={})).Int="int",Kn.UInt="uint",Kn.Buffer="buffer",Kn.BoolTrue="true",Kn.BoolFalse="false",Kn.PrincipalStandard="address",Kn.PrincipalContract="contract",Kn.ResponseOk="ok",Kn.ResponseErr="err",Kn.OptionalNone="none",Kn.OptionalSome="some",Kn.List="list",Kn.Tuple="tuple",Kn.StringASCII="ascii",Kn.StringUTF8="utf8",function(t){t[t.int=0]="int",t[t.uint=1]="uint",t[t.buffer=2]="buffer",t[t.true=3]="true",t[t.false=4]="false",t[t.address=5]="address",t[t.contract=6]="contract",t[t.ok=7]="ok",t[t.err=8]="err",t[t.none=9]="none",t[t.some=10]="some",t[t.list=11]="list",t[t.tuple=12]="tuple",t[t.ascii=13]="ascii",t[t.utf8=14]="utf8"}(Ln||(Ln={}));const Wn=BigInt("0xffffffffffffffffffffffffffffffff"),Vn=BigInt(0),qn=BigInt("0x7fffffffffffffffffffffffffffffff"),zn=BigInt("-170141183460469231731687303715884105728"),Xn=t=>{const n=e(t);if(n<Vn)throw new RangeError("Cannot construct unsigned clarity integer from negative value");if(n>Wn)throw new RangeError(`Cannot construct unsigned clarity integer greater than ${Wn}`);return{type:$n.UInt,value:n}},Zn=t=>{if(t.byteLength>1048576)throw new Error("Cannot construct clarity buffer that is greater than 1MB");return{type:$n.Buffer,value:d(t)}};var Jn,Yn;function Qn(t,e){return{type:Jn.LengthPrefixedList,lengthPrefixBytes:e||4,values:t}}function tr(t){if(f(t).byteLength!=tt)throw Error("Invalid signature");return{type:Jn.MessageSignature,data:t}}function er(t,e,n){const r=e||1,i=n||J;if(Rr(t,i))throw new Error(`String length exceeds maximum bytes ${i}`);return{type:Jn.LengthPrefixedString,content:t,lengthPrefixBytes:r,maxLengthBytes:i}}function nr(t){const e=(0,Mn.yI)(t);return{type:Jn.Address,version:e[0],hash160:e[1]}}function rr(t,e){return{pubKeyEncoding:t,type:Jn.TransactionAuthField,contents:e}}(Yn=Jn||(Jn={}))[Yn.Address=0]="Address",Yn[Yn.Principal=1]="Principal",Yn[Yn.LengthPrefixedString=2]="LengthPrefixedString",Yn[Yn.MemoString=3]="MemoString",Yn[Yn.Asset=4]="Asset",Yn[Yn.PostCondition=5]="PostCondition",Yn[Yn.PublicKey=6]="PublicKey",Yn[Yn.LengthPrefixedList=7]="LengthPrefixedList",Yn[Yn.Payload=8]="Payload",Yn[Yn.MessageSignature=9]="MessageSignature",Yn[Yn.StructuredDataSignature=10]="StructuredDataSignature",Yn[Yn.TransactionAuthField=11]="TransactionAuthField";class ir extends Ht{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ot.hash(t);const n=Ut(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return Ot.exists(this),this.iHash.update(t),this}digestInto(t){Ot.exists(this),Ot.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return t.finished=r,t.destroyed=i,t.blockLen=o,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const or=(t,e,n)=>new ir(t,e).update(n).digest();or.create=(t,e)=>new ir(t,e);const sr=32;function ar(t){if(t.length<2*sr*2+1)throw new Error("Invalid signature");const e=t.slice(0,2),n=t.slice(2,2+2*sr),r=t.slice(2+2*sr);return{recoveryId:a(e),r:n,s:r}}function cr(t){return t.slice(-2)+t.slice(0,-2)}function ur(t){const e="string"==typeof t?f(t):t;if(32!=e.length&&33!=e.length)throw new Error(`Improperly formatted private-key. Private-key byte length should be 32 or 33. Length provided: ${e.length}`);if(33==e.length&&1!==e[32])throw new Error("Improperly formatted private-key. 33 bytes indicate compressed key, but the last byte must be == 01");return e}function hr(t){return t="string"==typeof t?f(t):t,{type:Jn.PublicKey,data:t}}function dr(t){return"string"==typeof t?t:d(t)}Dn.hmacSha256Sync=(t,...e)=>{const n=or.create(se,t);return e.forEach((t=>n.update(t))),n.digest()};const fr=dr;function lr(t){return("string"==typeof t?t.length/2:t.byteLength)===S}function pr(t){return!fr(t).startsWith("04")}function gr(t){const e=lr(t=ur(t));return d(function(t,e=!1){return en.fromPrivateKey(t).toRawBytes(e)}(t.slice(0,32),e))}function yr(t,e){t=ur(t);const[n,r]=function(t,e,n={}){const{seed:r,m:i,d:o}=function(t,e,n){if(null==t)throw new Error(`sign: expected valid message hash, not "${t}"`);const r=yn(t),i=Tn(e),o=[On(i),Rn(r)];if(null!=n){!0===n&&(n=Dn.randomBytes(Ge));const t=yn(n);if(t.length!==Ge)throw new Error(`sign: Expected ${Ge} bytes of extra data`);o.push(t)}return{seed:sn(...o),m:kn(r),d:i}}(t,e,n.extraEntropy),s=new xn(We,Fe);let a;for(s.reseedSync(r);!(a=_n(s.generateSync(),i,o,n.canonical));)s.reseedSync();return function(t,e){const{sig:n,recovery:r}=t,{der:i,recovered:o}=Object.assign({canonical:!0,der:!0},e),s=i?n.toDERRawBytes():n.toCompactRawBytes();return o?[s,r]:s}(a,n)}(e,t.slice(0,32),{canonical:!0,recovered:!0});if(null==r)throw new Error("No signature recoveryId received");return s(r,1)+on.fromHex(n).toCompactHex()}function wr(t,e,n,r){if(0===r.length)throw Error("Invalid number of public keys");if(!(e!==dt.P2PKH&&e!==dt.P2WPKH||1===r.length&&1===n))throw Error("Invalid number of public keys or signatures");if((e===dt.P2WPKH||e===dt.P2WSH||e===dt.P2WSHNonSequential)&&!r.map((t=>t.data)).every(pr))throw Error("Public keys must be compressed for segwit");switch(e){case dt.P2PKH:return br(t,Hr(r[0].data));case dt.P2WPKH:return br(t,Dr(r[0].data));case dt.P2SH:case dt.P2SHNonSequential:return br(t,$r(n,r.map(ti)));case dt.P2WSH:case dt.P2WSHNonSequential:return br(t,Lr(n,r.map(ti)))}}function br(t,e){return{type:Jn.Address,version:t,hash160:e}}function Ar(t){return(0,Mn.H4)(t.version,t.hash160)}function mr(t){const[e,n,r]=t.split(/\.|::/);var i,o,s;return i=e,o=n,s=r,{type:Jn.Asset,address:nr(i),contractName:er(o),assetName:er(s)}}function Er(t){if(t.includes(".")){const[e,n]=t.split(".");return function(t,e){const n=nr(t),r=er(e);return{type:Jn.Principal,prefix:gt.Contract,address:n,contractName:r}}(e,n)}return function(t){const e=nr(t);return{type:Jn.Principal,prefix:gt.Standard,address:e}}(t)}function Sr(t){if(t.includes(".")){const[e,n]=t.split(".");return function(t,e){return vr(nr(t),er(e))}(e,n)}return function(t){const e=nr(t);return{type:$n.PrincipalStandard,value:Ar(e)}}(t)}function vr(t,e){if(l(e.content).byteLength>=128)throw new Error("Contract name must be less than 128 bytes");return{type:$n.PrincipalContract,value:`${Ar(t)}.${e.content}`}}function xr(){return{type:$n.OptionalNone}}function Ir(t){return{type:$n.OptionalSome,value:t}}function Cr(t){for(const n in t)if(!(/^[a-zA-Z]([a-zA-Z0-9]|[-_!?+<>=/*])*$|^[-+=/*]$|^[<>]=?$/.test(e=n)&&e.length<128))throw new Error(`"${n}" is not a valid Clarity name`);var e;return{type:$n.Tuple,value:t}}const _r=t=>({type:$n.StringASCII,value:t});function Tr(t){let n;if("string"==typeof t){const e="0x"===t.slice(0,2).toLowerCase();n=new Z(f(e?t.slice(2):t))}else n=t instanceof Uint8Array?new Z(t):t;switch(n.readUInt8Enum(Ln,(t=>{throw new K(`Cannot recognize Clarity Type: ${t}`)}))){case Ln.int:return(t=>{"string"==typeof t&&t.toLowerCase().startsWith("0x")&&(t=u(f(t))),E(t,Uint8Array)&&(t=u(t));const n=e(t);if(n>qn)throw new RangeError(`Cannot construct clarity integer from value greater than ${qn}`);if(n<zn)throw new RangeError(`Cannot construct clarity integer form value less than ${zn}`);return{type:$n.Int,value:n}})(u(n.readBytes(16)));case Ln.uint:return Xn(n.readBytes(16));case Ln.buffer:const t=n.readUInt32BE();return Zn(n.readBytes(t));case Ln.true:return{type:$n.BoolTrue};case Ln.false:return{type:$n.BoolFalse};case Ln.address:return s=Vr(n),{type:$n.PrincipalStandard,value:Ar(s)};case Ln.contract:return vr(Vr(n),Xr(n));case Ln.ok:return o=Tr(n),{type:$n.ResponseOk,value:o};case Ln.err:return function(t){return{type:$n.ResponseErr,value:t}}(Tr(n));case Ln.none:return xr();case Ln.some:return Ir(Tr(n));case Ln.list:const a=n.readUInt32BE(),c=[];for(let t=0;t<a;t++)c.push(Tr(n));return i=c,{type:$n.List,value:i};case Ln.tuple:const h=n.readUInt32BE(),d={};for(let t=0;t<h;t++){const t=Xr(n).content;if(void 0===t)throw new K('"content" is undefined');d[t]=Tr(n)}return Cr(d);case Ln.ascii:const l=n.readUInt32BE(),g=y(n.readBytes(l));return _r(g);case Ln.utf8:const w=n.readUInt32BE(),b=p(n.readBytes(w));return r=b,{type:$n.StringUTF8,value:r};default:throw new K("Unable to deserialize Clarity Value from Uint8Array. Could not find valid Clarity Type.")}var r,i,o,s}const Pr=t=>t.length%2?`0${t}`:t,kr=(t,e)=>t.padEnd(e,"0"),Rr=(t,e)=>!!t&&l(t).length>e;function Or(t){return Gn()(t)}function Br(t,e){const n=Or(t);return delete n[e],n}const Nr=t=>Qt(se(t)),Ur=t=>d(Oe(t)),Hr=t=>d(Nr(t)),Dr=t=>{const e=Nr(t),n=A(new Uint8Array([0]),new Uint8Array([e.length]),e);return d(Nr(n))},$r=(t,e)=>{if(t>15||e.length>15)throw Error("P2SH multisig address can only contain up to 15 public keys");const n=[];n.push(80+t),e.forEach((t=>{n.push(t.length),n.push(t)})),n.push(80+e.length),n.push(174);const r=m(n);return d(Nr(r))},Lr=(t,e)=>{if(t>15||e.length>15)throw Error("P2WSH multisig address can only contain up to 15 public keys");const n=[];n.push(80+t),e.forEach((t=>{n.push(t.length),n.push(t)})),n.push(80+e.length),n.push(174);const r=m(n),i=se(r),o=[];o.push(0),o.push(i.length),o.push(i);const s=m(o);return d(Nr(s))};const Kr=t=>{if(t.okay)return Tr(t.result);throw new Error(t.cause)};function Mr(t,e){return m([Fn(t),e])}function jr(t,e){const n=[],r="ascii"==e?g(t.value):l(t.value),i=new Uint8Array(4);return V(i,r.length,0),n.push(i),n.push(r),Mr(t.type,m(n))}function Gr(t){switch(t.type){case $n.BoolTrue:case $n.BoolFalse:return function(t){return new Uint8Array([Fn(t.type)])}(t);case $n.OptionalNone:case $n.OptionalSome:return(e=t).type===$n.OptionalNone?new Uint8Array([Fn(e.type)]):Mr(e.type,Gr(e.value));case $n.Buffer:return function(t){const e=new Uint8Array(4);return V(e,Math.ceil(t.value.length/2),0),Mr(t.type,A(e,f(t.value)))}(t);case $n.UInt:return function(t){const e=c(BigInt(t.value),Q);return Mr(t.type,e)}(t);case $n.Int:return function(t){const e=c(function(t,e){if(t<-(BigInt(1)<<e-BigInt(1))||(BigInt(1)<<e-BigInt(1))-BigInt(1)<t)throw`Unable to represent integer in width: ${e}`;return t>=BigInt(0)?BigInt(t):t+(BigInt(1)<<e)}(BigInt(t.value),BigInt(Y)),Q);return Mr(t.type,e)}(t);case $n.PrincipalStandard:return function(t){return Mr(t.type,Wr(nr(t.value)))}(t);case $n.PrincipalContract:return function(t){const[e,n]=function(t){const[e,n]=t.split(".");if(!e||!n)throw new Error(`Invalid contract identifier: ${t}`);return[e,n]}(t.value);return Mr(t.type,A(Wr(nr(e)),zr(er(n))))}(t);case $n.ResponseOk:case $n.ResponseErr:return function(t){return Mr(t.type,Gr(t.value))}(t);case $n.List:return function(t){const e=[],n=new Uint8Array(4);V(n,t.value.length,0),e.push(n);for(const n of t.value){const t=Gr(n);e.push(t)}return Mr(t.type,m(e))}(t);case $n.Tuple:return function(t){const e=[],n=new Uint8Array(4);V(n,Object.keys(t.value).length,0),e.push(n);const r=Object.keys(t.value).sort(((t,e)=>t.localeCompare(e)));for(const n of r){const r=er(n);e.push(zr(r));const i=Gr(t.value[n]);e.push(i)}return Mr(t.type,m(e))}(t);case $n.StringASCII:return function(t){return jr(t,"ascii")}(t);case $n.StringUTF8:return function(t){return jr(t,"utf8")}(t);default:throw new L("Unable to serialize. Invalid Clarity Value.")}var e}function Fr(e){switch(e.type){case Jn.Address:return Wr(e);case Jn.Principal:return qr(e);case Jn.LengthPrefixedString:return zr(e);case Jn.MemoString:return function(t){const e=[],n=l(t.content),r=kr(d(n),2*et);return e.push(f(r)),m(e)}(e);case Jn.Asset:return Zr(e);case Jn.PostCondition:return function(e){const n=[];if(n.push(e.conditionType),n.push(qr(e.principal)),e.conditionType!==ut.Fungible&&e.conditionType!==ut.NonFungible||n.push(Zr(e.asset)),e.conditionType===ut.NonFungible&&n.push(Gr(e.assetName)),n.push(e.conditionCode),e.conditionType===ut.STX||e.conditionType===ut.Fungible){if(e.amount>BigInt("0xffffffffffffffff"))throw new L("The post-condition amount may not be larger than 8 bytes");n.push(t(e.amount,8))}return m(n)}(e);case Jn.PublicKey:return ti(e);case Jn.LengthPrefixedList:return Jr(e);case Jn.Payload:return Yr(e);case Jn.TransactionAuthField:return function(t){const e=[];switch(t.contents.type){case Jn.PublicKey:e.push(t.pubKeyEncoding===ft.Compressed?bt.PublicKeyCompressed:bt.PublicKeyUncompressed),e.push(f((n=t.contents.data,en.fromHex(fr(n)).toHex(!0))));break;case Jn.MessageSignature:e.push(t.pubKeyEncoding===ft.Compressed?bt.SignatureCompressed:bt.SignatureUncompressed),e.push(Qr(t.contents))}var n;return m(e)}(e);case Jn.MessageSignature:return Qr(e)}}function Wr(t){const e=[];return e.push(f(s(t.version,1))),e.push(f(t.hash160)),m(e)}function Vr(t){const e=E(t,Z)?t:new Z(t),n=a(d(e.readBytes(1))),r=d(e.readBytes(20));return{type:Jn.Address,version:n,hash160:r}}function qr(t){const e=[];return e.push(t.prefix),t.prefix!==gt.Standard&&t.prefix!==gt.Contract||e.push(Wr(t.address)),t.prefix===gt.Contract&&e.push(zr(t.contractName)),m(e)}function zr(t){const e=[],n=l(t.content),r=n.byteLength;return e.push(f(s(r,t.lengthPrefixBytes))),e.push(n),m(e)}function Xr(t,e,n){e=e||1;const r=E(t,Z)?t:new Z(t),i=a(d(r.readBytes(e)));return er(p(r.readBytes(i)),e,n??128)}function Zr(t){const e=[];return e.push(Wr(t.address)),e.push(zr(t.contractName)),e.push(zr(t.assetName)),m(e)}function Jr(t){const e=t.values,n=[];n.push(f(s(e.length,t.lengthPrefixBytes)));for(const t of e)n.push(Fr(t));return m(n)}function Yr(e){const n=[];switch(n.push(e.payloadType),e.payloadType){case nt.TokenTransfer:n.push(Gr(e.recipient)),n.push(t(e.amount,8)),n.push(Fr(e.memo));break;case nt.ContractCall:n.push(Fr(e.contractAddress)),n.push(Fr(e.contractName)),n.push(Fr(e.functionName));const r=new Uint8Array(4);V(r,e.functionArgs.length,0),n.push(r),e.functionArgs.forEach((t=>{n.push(Gr(t))}));break;case nt.SmartContract:n.push(Fr(e.contractName)),n.push(Fr(e.codeBody));break;case nt.VersionedSmartContract:n.push(e.clarityVersion),n.push(Fr(e.contractName)),n.push(Fr(e.codeBody));break;case nt.PoisonMicroblock:break;case nt.Coinbase:n.push(e.coinbaseBytes);break;case nt.CoinbaseToAltRecipient:n.push(e.coinbaseBytes),n.push(Gr(e.recipient));break;case nt.NakamotoCoinbase:n.push(e.coinbaseBytes),n.push(Gr(e.recipient?Ir(e.recipient):xr())),n.push(e.vrfProof);break;case nt.TenureChange:n.push(f(e.tenureHash)),n.push(f(e.previousTenureHash)),n.push(f(e.burnViewHash)),n.push(f(e.previousTenureEnd)),n.push(V(new Uint8Array(4),e.previousTenureBlocks)),n.push(W(new Uint8Array(1),e.cause)),n.push(f(e.publicKeyHash))}return m(n)}function Qr(t){return f(t.data)}function ti(t){return t.data.slice()}function ei(){return{type:Jn.MessageSignature,data:d(new Uint8Array(tt))}}function ni(t,n,r,i){const o=wr(0,t,1,[hr(n)]).hash160,s=pr(n)?ft.Compressed:ft.Uncompressed;return{hashMode:t,signer:o,nonce:e(r),fee:e(i),keyEncoding:s,signature:ei()}}function ri(t){return"signature"in t}function ii(t){return t===dt.P2SH||t===dt.P2WSH}function oi(t){return t===dt.P2SHNonSequential||t===dt.P2WSHNonSequential}function si(t){const e=Or(t);return e.nonce=0,e.fee=0,ri(e)?e.signature=ei():e.fields=[],{...e,nonce:BigInt(0),fee:BigInt(0)}}function ai(e){return ri(e)?function(e){return m([e.hashMode,f(e.signer),t(e.nonce,8),t(e.fee,8),e.keyEncoding,Qr(e.signature)])}(e):function(e){const n=[e.hashMode,f(e.signer),t(e.nonce,8),t(e.fee,8)],r=Qn(e.fields);n.push(Jr(r));const i=new Uint8Array(2);return function(t,e,n=0){t[n+0]=e>>>8,t[n+1]=e>>>0}(i,e.signaturesRequired,0),n.push(i),m(n)}(e)}function ci(e,n,r,i){const o=e+d(new Uint8Array([n]))+d(t(r,8))+d(t(i,8));if(49!==f(o).byteLength)throw Error("Invalid signature hash length");return Ur(f(o))}function ui(t,e,n){const r=33+tt,i=pr(e.data)?ft.Compressed:ft.Uncompressed,o=f(t+Pr(i.toString(16))+n);if(o.byteLength>r)throw Error("Invalid signature hash length");return Ur(o)}function hi(t,e,n,i,o,s){const a=ci(t,e,n,i),c=hr(function(t,e,n=ft.Compressed){const i=ar(e),o=new on(r(i.r),r(i.s)),s=en.fromSignature(t,o,i.recoveryId),a=n===ft.Compressed;return s.toHex(a)}(a,s,o));return{pubKey:c,nextSigHash:ui(a,c,s)}}function di(t){return{authType:ht.Standard,spendingCondition:t}}function fi(t,e){return{authType:ht.Sponsored,spendingCondition:t,sponsorSpendingCondition:e||ni(dt.P2PKH,"0".repeat(66),0,0)}}function li(t){if(t.spendingCondition)switch(t.authType){case ht.Standard:return di(si(t.spendingCondition));case ht.Sponsored:return fi(si(t.spendingCondition),function(){const t=ni(dt.P2PKH,"",0,0);return t.signer=(Jn.Address,P.MainnetSingleSig,"0".repeat(40)),t.keyEncoding=ft.Compressed,t.signature=ei(),t}());default:throw new j("Unexpected authorization type for signing")}throw new Error("Authorization missing SpendingCondition")}class pi{constructor({auth:t,payload:n,postConditions:r=Qn([]),postConditionMode:i=ct.Deny,transactionVersion:o,chainId:s,network:a="mainnet"}){a=H(a),this.transactionVersion=o??a.transactionVersion,this.chainId=s??a.chainId,this.auth=t,this.payload="amount"in n?{...n,amount:e(n.amount)}:n,this.postConditionMode=i,this.postConditions=r,this.anchorMode=it.Any}signBegin(){const t=Or(this);return t.auth=li(t.auth),t.txid()}verifyBegin(){const t=Or(this);return t.auth=li(t.auth),t.txid()}verifyOrigin(){return function(t,e){switch(t.authType){case ht.Standard:case ht.Sponsored:return function(t,e,n){return ri(t)?function(t,e,n){const{pubKey:r,nextSigHash:i}=hi(e,n,t.fee,t.nonce,t.keyEncoding,t.signature.data),o=wr(0,t.hashMode,1,[r]).hash160;if(o!==t.signer)throw new G(`Signer hash does not equal hash of public key(s): ${o} != ${t.signer}`);return i}(t,e,n):function(t,e,n){const r=[];let i=e,o=!1,s=0;for(const e of t.fields)switch(e.contents.type){case Jn.PublicKey:pr(e.contents.data)||(o=!0),r.push(e.contents);break;case Jn.MessageSignature:e.pubKeyEncoding===ft.Uncompressed&&(o=!0);const{pubKey:a,nextSigHash:c}=hi(i,n,t.fee,t.nonce,e.pubKeyEncoding,e.contents.data);if(ii(t.hashMode)&&(i=c),r.push(a),s+=1,65536===s)throw new G("Too many signatures")}if(ii(t.hashMode)&&s!==t.signaturesRequired||oi(t.hashMode)&&s<t.signaturesRequired)throw new G("Incorrect number of signatures");if(o&&(t.hashMode===dt.P2WSH||t.hashMode===dt.P2WSHNonSequential))throw new G("Uncompressed keys are not allowed in this hash mode");const a=wr(0,t.hashMode,t.signaturesRequired,r).hash160;if(a!==t.signer)throw new G(`Signer hash does not equal hash of public key(s): ${a} != ${t.signer}`);return i}(t,e,n)}(t.spendingCondition,e,ht.Standard);default:throw new j("Invalid origin auth type")}}(this.auth,this.verifyBegin())}signNextOrigin(t,e){if(void 0===this.auth.spendingCondition)throw new Error('"auth.spendingCondition" is undefined');if(void 0===this.auth.authType)throw new Error('"auth.authType" is undefined');return this.signAndAppend(this.auth.spendingCondition,t,ht.Standard,e)}signNextSponsor(t,e){if(this.auth.authType===ht.Sponsored)return this.signAndAppend(this.auth.sponsorSpendingCondition,t,ht.Sponsored,e);throw new Error('"auth.sponsorSpendingCondition" is undefined')}appendPubkey(t){const e="object"==typeof t&&"type"in t?t:hr(t),n=this.auth.spendingCondition;if(!n||ri(n))throw new Error("Can't append public key to a singlesig condition");{const t=pr(e.data);n.fields.push(rr(t?ft.Compressed:ft.Uncompressed,e))}}signAndAppend(t,e,n,r){const{nextSig:i,nextSigHash:o}=function(t,e,n,r,i){const o=ci(t,e,n,r),s=yr(i,o);return{nextSig:s,nextSigHash:ui(o,hr(gr(i)),s)}}(e,n,t.fee,t.nonce,r);if(ri(t))t.signature=tr(i);else{const e=lr(r);t.fields.push(rr(e?ft.Compressed:ft.Uncompressed,tr(i)))}return o}txid(){const t=this.serializeBytes();return Ur(t)}setSponsor(t){if(this.auth.authType!=ht.Sponsored)throw new j("Cannot sponsor sign a non-sponsored transaction");this.auth=function(t,n){return{...t,sponsorSpendingCondition:{...n,nonce:e(n.nonce),fee:e(n.fee)}}}(this.auth,t)}setFee(t){this.auth=function(t,n){switch(t.authType){case ht.Standard:const r={...t.spendingCondition,fee:e(n)};return{...t,spendingCondition:r};case ht.Sponsored:const i={...t.sponsorSpendingCondition,fee:e(n)};return{...t,sponsorSpendingCondition:i}}}(this.auth,t)}setNonce(t){this.auth=function(t,n){const r={...t.spendingCondition,nonce:e(n)};return{...t,spendingCondition:r}}(this.auth,t)}setSponsorNonce(t){if(this.auth.authType!=ht.Sponsored)throw new j("Cannot sponsor sign a non-sponsored transaction");this.auth=function(t,n){const r={...t.sponsorSpendingCondition,nonce:e(n)};return{...t,sponsorSpendingCondition:r}}(this.auth,t)}serialize(){return d(this.serializeBytes())}serializeBytes(){if(void 0===this.transactionVersion)throw new L('"transactionVersion" is undefined');if(void 0===this.chainId)throw new L('"chainId" is undefined');if(void 0===this.auth)throw new L('"auth" is undefined');if(void 0===this.payload)throw new L('"payload" is undefined');const t=[];t.push(this.transactionVersion);const e=new Uint8Array(4);return V(e,this.chainId,0),t.push(e),t.push(function(t){const e=[];switch(e.push(t.authType),t.authType){case ht.Standard:e.push(ai(t.spendingCondition));break;case ht.Sponsored:e.push(ai(t.spendingCondition)),e.push(ai(t.sponsorSpendingCondition))}return m(e)}(this.auth)),t.push(this.anchorMode),t.push(this.postConditionMode),t.push(Jr(this.postConditions)),t.push(Yr(this.payload)),m(t)}}function gi(t){return(e=t.transactionVersion,t=>t[e])({[T.Mainnet]:R,[T.Testnet]:O});var e}const yi="/v2/fees/transfer",wi="/v2/fees/transaction",bi="/v2/accounts",Ai="/v2/contracts/interface";async function mi({transaction:t,attachment:e,network:r,client:i}){const o=t.serialize(),s=e?"string"==typeof e?e:d(e):void 0,a=e?{tx:o,attachment:s}:{tx:o},c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},u=r??gi(t),h=Object.assign({},D(H(u)),i),f=`${h.baseUrl}/v2/transactions`,l=await h.fetch(f,c);if(!l.ok)try{return await l.json()}catch(t){throw Error("Failed to broadcast transaction (unable to parse node response).",{cause:t})}const p=await l.text(),g=p.replace(/["]+/g,"");if(64!==(y=n(y=g)).length||!/^[0-9a-fA-F]+$/.test(y))throw new Error(p);var y;return{txid:g}}async function Ei({contractName:t,contractAddress:e,functionName:n,functionArgs:r,senderAddress:i,network:o="mainnet",client:s}){const a={sender:i,arguments:r.map((t=>`0x${d(Gr(t))}`))},c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},u=encodeURIComponent(n),h=Object.assign({},D(H(o)),s),f=`${h.baseUrl}/v2/contracts/call-read/${e}/${t}/${u}`,l=await h.fetch(f,c);if(!l.ok){const t=await l.text().catch((()=>""));throw new Error(`Error calling read-only function. Response ${l.status}: ${l.statusText}. Attempted to fetch ${f} and failed with the message: "${t}"`)}return await l.json().then(Kr)}function Si(t,e="hex"){switch(t.type){case $n.BoolTrue:return"true";case $n.BoolFalse:return"false";case $n.Int:return t.value.toString();case $n.UInt:return`u${t.value.toString()}`;case $n.Buffer:if("tryAscii"===e){const e=y(f(t.value));if(/[ -~]/.test(e))return JSON.stringify(e)}return`0x${t.value}`;case $n.OptionalNone:return"none";case $n.OptionalSome:return`(some ${Si(t.value,e)})`;case $n.ResponseErr:return`(err ${Si(t.value,e)})`;case $n.ResponseOk:return`(ok ${Si(t.value,e)})`;case $n.PrincipalStandard:case $n.PrincipalContract:return t.value;case $n.List:return`(list ${t.value.map((t=>Si(t,e))).join(" ")})`;case $n.Tuple:return`(tuple ${Object.keys(t.value).map((n=>`(${n} ${Si(t.value[n],e)})`)).join(" ")})`;case $n.StringASCII:return`"${t.value}"`;case $n.StringUTF8:return`u"${t.value}"`}}function vi(t){switch(t.type){case $n.BoolTrue:case $n.BoolFalse:return"bool";case $n.Int:return"int";case $n.UInt:return"uint";case $n.Buffer:return`(buff ${Math.ceil(t.value.length/2)})`;case $n.OptionalNone:return"(optional none)";case $n.OptionalSome:return`(optional ${vi(t.value)})`;case $n.ResponseErr:return`(response UnknownType ${vi(t.value)})`;case $n.ResponseOk:return`(response ${vi(t.value)} UnknownType)`;case $n.PrincipalStandard:case $n.PrincipalContract:return"principal";case $n.List:return`(list ${t.value.length} ${t.value.length?vi(t.value[0]):"UnknownType"})`;case $n.Tuple:return`(tuple ${Object.keys(t.value).map((e=>`(${e} ${vi(t.value[e])})`)).join(" ")})`;case $n.StringASCII:return`(string-ascii ${g(t.value).length})`;case $n.StringUTF8:return`(string-utf8 ${l(t.value).length})`}}var xi;!function(t){t[t.ClarityAbiTypeUInt128=1]="ClarityAbiTypeUInt128",t[t.ClarityAbiTypeInt128=2]="ClarityAbiTypeInt128",t[t.ClarityAbiTypeBool=3]="ClarityAbiTypeBool",t[t.ClarityAbiTypePrincipal=4]="ClarityAbiTypePrincipal",t[t.ClarityAbiTypeNone=5]="ClarityAbiTypeNone",t[t.ClarityAbiTypeBuffer=6]="ClarityAbiTypeBuffer",t[t.ClarityAbiTypeResponse=7]="ClarityAbiTypeResponse",t[t.ClarityAbiTypeOptional=8]="ClarityAbiTypeOptional",t[t.ClarityAbiTypeTuple=9]="ClarityAbiTypeTuple",t[t.ClarityAbiTypeList=10]="ClarityAbiTypeList",t[t.ClarityAbiTypeStringAscii=11]="ClarityAbiTypeStringAscii",t[t.ClarityAbiTypeStringUtf8=12]="ClarityAbiTypeStringUtf8",t[t.ClarityAbiTypeTraitReference=13]="ClarityAbiTypeTraitReference"}(xi||(xi={}));const Ii=t=>"string"==typeof t,Ci=t=>void 0!==t.buffer,_i=t=>void 0!==t["string-ascii"],Ti=t=>void 0!==t["string-utf8"],Pi=t=>void 0!==t.response,ki=t=>void 0!==t.optional,Ri=t=>void 0!==t.tuple,Oi=t=>void 0!==t.list;function Bi(t){if(Ii(t))return"int128"===t?"int":"uint128"===t?"uint":t;if(Ci(t))return`(buff ${t.buffer.length})`;if(_i(t))return`(string-ascii ${t["string-ascii"].length})`;if(Ti(t))return`(string-utf8 ${t["string-utf8"].length})`;if(Pi(t))return`(response ${Bi(t.response.ok)} ${Bi(t.response.error)})`;if(ki(t))return`(optional ${Bi(t.optional)})`;if(Ri(t))return`(tuple ${t.tuple.map((t=>`(${t.name} ${Bi(t.type)})`)).join(" ")})`;if(Oi(t))return`(list ${t.list.length} ${Bi(t.list.type)})`;throw new Error(`Type string unsupported for Clarity type: ${JSON.stringify(t)}`)}function Ni(t,e){const n=function(t){if(Ii(t)){if("uint128"===t)return{id:xi.ClarityAbiTypeUInt128,type:t};if("int128"===t)return{id:xi.ClarityAbiTypeInt128,type:t};if("bool"===t)return{id:xi.ClarityAbiTypeBool,type:t};if("principal"===t)return{id:xi.ClarityAbiTypePrincipal,type:t};if("trait_reference"===t)return{id:xi.ClarityAbiTypeTraitReference,type:t};if("none"===t)return{id:xi.ClarityAbiTypeNone,type:t};throw new Error(`Unexpected Clarity ABI type primitive: ${JSON.stringify(t)}`)}if(Ci(t))return{id:xi.ClarityAbiTypeBuffer,type:t};if(Pi(t))return{id:xi.ClarityAbiTypeResponse,type:t};if(ki(t))return{id:xi.ClarityAbiTypeOptional,type:t};if(Ri(t))return{id:xi.ClarityAbiTypeTuple,type:t};if(Oi(t))return{id:xi.ClarityAbiTypeList,type:t};if(_i(t))return{id:xi.ClarityAbiTypeStringAscii,type:t};if(Ti(t))return{id:xi.ClarityAbiTypeStringUtf8,type:t};throw new Error(`Unexpected Clarity ABI type: ${JSON.stringify(t)}`)}(e);switch(t.type){case $n.BoolTrue:case $n.BoolFalse:return n.id===xi.ClarityAbiTypeBool;case $n.Int:return n.id===xi.ClarityAbiTypeInt128;case $n.UInt:return n.id===xi.ClarityAbiTypeUInt128;case $n.Buffer:return n.id===xi.ClarityAbiTypeBuffer&&n.type.buffer.length>=Math.ceil(t.value.length/2);case $n.StringASCII:return n.id===xi.ClarityAbiTypeStringAscii&&n.type["string-ascii"].length>=t.value.length;case $n.StringUTF8:return n.id===xi.ClarityAbiTypeStringUtf8&&n.type["string-utf8"].length>=t.value.length;case $n.OptionalNone:return n.id===xi.ClarityAbiTypeNone||n.id===xi.ClarityAbiTypeOptional;case $n.OptionalSome:return n.id===xi.ClarityAbiTypeOptional&&Ni(t.value,n.type.optional);case $n.ResponseErr:return n.id===xi.ClarityAbiTypeResponse&&Ni(t.value,n.type.response.error);case $n.ResponseOk:return n.id===xi.ClarityAbiTypeResponse&&Ni(t.value,n.type.response.ok);case $n.PrincipalContract:return n.id===xi.ClarityAbiTypePrincipal||n.id===xi.ClarityAbiTypeTraitReference;case $n.PrincipalStandard:return n.id===xi.ClarityAbiTypePrincipal;case $n.List:return n.id==xi.ClarityAbiTypeList&&n.type.list.length>=t.value.length&&t.value.every((t=>Ni(t,n.type.list.type)));case $n.Tuple:if(n.id==xi.ClarityAbiTypeTuple){const e=Or(t.value);for(let t=0;t<n.type.tuple.length;t++){const r=n.type.tuple[t],i=r.name,o=e[i];if(!o)return!1;if(!Ni(o,r.type))return!1;delete e[i]}return!0}return!1;default:return!1}}const Ui={eq:lt.Equal,gt:lt.Greater,lt:lt.Less,gte:lt.GreaterEqual,lte:lt.LessEqual},Hi={sent:pt.Sends,"not-sent":pt.DoesNotSend};class Di{constructor(t){this.transaction=t,this.sigHash=t.signBegin(),this.originDone=!1,this.checkOversign=!0,this.checkOverlap=!0;const e=t.auth.spendingCondition;if(e&&!ri(e)){if(e.fields.filter((t=>t.contents.type===Jn.MessageSignature)).length>=e.signaturesRequired)throw new Error("SpendingCondition has more signatures than are expected");e.fields.forEach((n=>{if(n.contents.type!==Jn.MessageSignature)return;const r=n.contents,i=hi(this.sigHash,t.auth.authType,e.fee,e.nonce,ft.Compressed,r.data);oi(e.hashMode)||(this.sigHash=i.nextSigHash)}))}}static createSponsorSigner(t,e){if(t.auth.authType!=ht.Sponsored)throw new j("Cannot add sponsor to non-sponsored transaction");const n=Or(t);n.setSponsor(e);const r=n.verifyOrigin(),i=new this(n);return i.originDone=!0,i.sigHash=r,i.checkOversign=!0,i.checkOverlap=!0,i}signOrigin(t){if(this.checkOverlap&&this.originDone)throw new j("Cannot sign origin after sponsor key");if(void 0===this.transaction.auth)throw new j('"transaction.auth" is undefined');if(void 0===this.transaction.auth.spendingCondition)throw new j('"transaction.auth.spendingCondition" is undefined');const e=this.transaction.auth.spendingCondition;if((e.hashMode===dt.P2SH||e.hashMode===dt.P2WSH)&&this.checkOversign&&e.fields.filter((t=>t.contents.type===Jn.MessageSignature)).length>=e.signaturesRequired)throw new Error("Origin would have too many signatures");const n=this.transaction.signNextOrigin(this.sigHash,t);(ri(this.transaction.auth.spendingCondition)||ii(this.transaction.auth.spendingCondition.hashMode))&&(this.sigHash=n)}appendOrigin(t){const e="object"==typeof t&&"type"in t?t:hr(t);if(this.checkOverlap&&this.originDone)throw Error("Cannot append public key to origin after sponsor key");if(void 0===this.transaction.auth)throw new Error('"transaction.auth" is undefined');if(void 0===this.transaction.auth.spendingCondition)throw new Error('"transaction.auth.spendingCondition" is undefined');this.transaction.appendPubkey(e)}signSponsor(t){if(void 0===this.transaction.auth)throw new j('"transaction.auth" is undefined');if(this.transaction.auth.authType!==ht.Sponsored)throw new j('"transaction.auth.authType" is not AuthType.Sponsored');const e=this.transaction.signNextSponsor(this.sigHash,t);this.sigHash=e,this.originDone=!0}getTxInComplete(){return Or(this.transaction)}resume(t){this.transaction=Or(t),this.sigHash=t.signBegin()}}async function $i(t){const n={fee:BigInt(0),nonce:BigInt(0),network:R,postConditionMode:ct.Deny,sponsored:!1},r=Object.assign(n,t);r.network=H(r.network),r.client=Object.assign({},D(r.network),r.client),r.postConditionMode=function(t){if("number"==typeof t)return t;if("allow"===t)return ct.Allow;if("deny"===t)return ct.Deny;throw new Error(`Invalid post condition mode: ${t}`)}(r.postConditionMode);const i=(o=r.contractAddress,s=r.contractName,a=r.functionName,c=r.functionArgs,"string"==typeof s&&(s=er(s)),"string"==typeof a&&(a=er(a)),{type:Jn.Payload,payloadType:nt.ContractCall,contractAddress:"string"==typeof o?nr(o):o,contractName:s,functionName:a,functionArgs:c});var o,s,a,c;if(r?.validateWithAbi){let t;if("boolean"==typeof r.validateWithAbi){if(!r?.network)throw new Error("Network option must be provided in order to validate with ABI");t=await async function({contractAddress:t,contractName:e,network:n="mainnet",client:r}){const i=Object.assign({},D(H(n)),r),o=`${i.baseUrl}${Ai}/${t}/${e}`,s=await i.fetch(o);if(!s.ok){const n=await s.text().catch((()=>""));throw new Error(`Error fetching contract ABI for contract "${e}" at address ${t}. Response ${s.status}: ${s.statusText}. Attempted to fetch ${o} and failed with the message: "${n}"`)}return JSON.parse(await s.text())}({...r})}else t=r.validateWithAbi;!function(t,e){const n=e.functions.filter((e=>e.name===t.functionName.content));if(1===n.length){const e=n[0].args;if(t.functionArgs.length!==e.length)throw new Error(`Clarity function expects ${e.length} argument(s) but received ${t.functionArgs.length}`);for(let n=0;n<t.functionArgs.length;n++){const r=t.functionArgs[n],i=e[n];if(!Ni(r,i.type)){const e=n+1;throw new Error(`Clarity function \`${t.functionName.content}\` expects argument ${e} to be of type ${Bi(i.type)}, not ${vi(r)}`)}}return!0}throw 0===n.length?new Error(`ABI doesn't contain a function with the name ${t.functionName.content}`):new Error(`Malformed ABI. Contains multiple functions with the name ${t.functionName.content}`)}(i,t)}let u=null;if("publicKey"in r)u=ni(dt.P2PKH,r.publicKey,r.nonce,r.fee);else{const t=r.useNonSequentialMultiSig?dt.P2SHNonSequential:dt.P2SH,n=r.address?Ki(r.publicKeys.map(fr),r.numSignatures,t,nr(r.address).hash160):r.publicKeys.map(fr);u=function(t,n,r,i,o){return{hashMode:t,signer:wr(0,t,n,r.map(hr)).hash160,nonce:e(i),fee:e(o),fields:[],signaturesRequired:n}}(t,r.numSignatures,n,r.nonce,r.fee)}const h=r.sponsored?fi(u):di(u),f=Qn((r.postConditions??[]).map((t=>"string"==typeof t.type?function(t){switch(t.type){case"stx-postcondition":return{type:Jn.PostCondition,conditionType:ut.STX,principal:"origin"===t.address?{type:Jn.Principal,prefix:gt.Origin}:Er(t.address),conditionCode:Ui[t.condition],amount:BigInt(t.amount)};case"ft-postcondition":return{type:Jn.PostCondition,conditionType:ut.Fungible,principal:"origin"===t.address?{type:Jn.Principal,prefix:gt.Origin}:Er(t.address),conditionCode:Ui[t.condition],amount:BigInt(t.amount),asset:mr(t.asset)};case"nft-postcondition":return{type:Jn.PostCondition,conditionType:ut.NonFungible,principal:"origin"===t.address?{type:Jn.Principal,prefix:gt.Origin}:Er(t.address),conditionCode:Hi[t.condition],asset:mr(t.asset),assetName:t.assetId};default:throw new Error("Invalid post condition type")}}(t):t))),l=new pi({transactionVersion:r.network.transactionVersion,chainId:r.network.chainId,auth:h,payload:i,postConditions:f,postConditionMode:r.postConditionMode});if(void 0===t.fee||null===t.fee){const t=await async function({transaction:t,network:e,client:n}){const r=e??gi(t),i=Object.assign({},D(H(r)),n);try{const e=function(t){const e=t.auth.spendingCondition.hashMode;if([dt.P2SH,dt.P2WSH].includes(e)){const e=t.auth.spendingCondition,n=e.fields.filter((t=>t.contents.type===Jn.MessageSignature)).length,r=(e.signaturesRequired-n)*(tt+1);return t.serializeBytes().byteLength+r}return t.serializeBytes().byteLength}(t);return(await async function({payload:t,estimatedLength:e,network:n="mainnet",client:r}){const i={transaction_payload:t,estimated_len:e},o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)},s=Object.assign({},D(H(n)),r),a=`${s.baseUrl}${wi}`,c=await s.fetch(a,o);if(!c.ok){const t=await c.json().catch((()=>({})));if("NoEstimateAvailable"===t?.reason)throw new M(t?.reason_data?.message??"");throw new Error(`Error estimating transaction fee. Response ${c.status}: ${c.statusText}. Attempted to fetch ${a} and failed with the message: "${t}"`)}return(await c.json()).estimations}({payload:d(Yr(t.payload)),estimatedLength:e,network:r,client:i}))[1].fee}catch(e){if(!(e instanceof M))throw e;return await async function({transaction:t,network:e,client:n}){const r=e??gi(t),i=Object.assign({},D(H(r)),n),o=`${i.baseUrl}${yi}`,s=await i.fetch(o,{headers:{Accept:"application/text"}});if(!s.ok){const t=await s.text().catch((()=>""));throw new Error(`Error estimating transfer fee. Response ${s.status}: ${s.statusText}. Attempted to fetch ${o} and failed with the message: "${t}"`)}const a=await s.text(),c=BigInt(Math.ceil(t.serializeBytes().byteLength));return BigInt(a)*c}({transaction:t,network:r})}}({transaction:l,...r});l.setFee(t)}if(void 0===t.nonce||null===t.nonce){const t=r.network.addressVersion.singleSig,e=(0,Mn.H4)(t,l.auth.spendingCondition.signer),n=await async function(t){try{return await async function({address:t,network:e="mainnet",client:n}){const r=Object.assign({},D(H(e)),n),i=`${r.baseUrl}/extended/v1/address/${t}/nonces`,o=await r.fetch(i),s=await o.json();return BigInt(s.possible_next_nonce)}(t)}catch(t){}const e=H(t.network??"mainnet"),n=Object.assign({},D(e),t.client),r=`${n.baseUrl}${bi}/${t.address}?proof=0`,i=await n.fetch(r);if(!i.ok){const t=await i.text().catch((()=>""));throw new Error(`Error fetching nonce. Response ${i.status}: ${i.statusText}. Attempted to fetch ${r} and failed with the message: "${t}"`)}const o=await i.json();return BigInt(o.nonce)}({address:e,...r});l.setNonce(n)}return l}async function Li(t){if("senderKey"in t){const e=gr(t.senderKey),n=Br(t,"senderKey"),r=await $i({publicKey:e,...n}),i=t.senderKey;return new Di(r).signOrigin(i),r}{const e=Br(t,"signerKeys"),n=await $i(e);return function(t,e,n,r){if(ri(t.auth.spendingCondition))throw new Error("Transaction is not a multi-sig transaction");const i=new Di(t),o=r?Ki(e,t.auth.spendingCondition.signaturesRequired,t.auth.spendingCondition.hashMode,nr(r).hash160):e;for(const t of o){const e=n.find((e=>gr(e)===t));e?i.signOrigin(e):i.appendOrigin(t)}}(n,t.publicKeys.map(fr).slice(),t.signerKeys.map(dr),t.address),n}}function Ki(t,e,n,r){if(wr(0,n,e,t.map(hr)).hash160===r)return t;const i=t.slice().sort();if(wr(0,n,e,i.map(hr)).hash160===r)return i;throw new Error("Failed to find matching multi-sig address given public-keys.")}var Mi=(t=>(t[t.P2PKH=0]="P2PKH",t[t.P2SH=1]="P2SH",t[t.P2SHP2WPKH=2]="P2SHP2WPKH",t[t.P2SHP2WSH=3]="P2SHP2WSH",t[t.P2WPKH=4]="P2WPKH",t[t.P2WSH=5]="P2WSH",t[t.P2TR=6]="P2TR",t))(Mi||{});const ji={mainnet:{P2PKH:0,P2SH:5},testnet:{P2PKH:111,P2SH:196},devnet:{P2PKH:111,P2SH:196},mocknet:{P2PKH:111,P2SH:196}},Gi=/^(1|3|m|n|2)/,Fi=/^(bc1q|tb1q|bcrt1q)/i,Wi=/^(bc1p|tb1p|bcrt1p)/i,Vi={mainnet:"bc",testnet:"tb",devnet:"bcrt",mocknet:"bcrt"},qi=/^(bc|tb)/i,zi=0,Xi=1;var Zi=(t=>(t.Period1="Period1",t.Period2a="Period2a",t.Period2b="Period2b",t.Period3="Period3",t))(Zi||{}),Ji=(t=>(t[t.ERR_STACKING_UNREACHABLE=255]="ERR_STACKING_UNREACHABLE",t[t.ERR_STACKING_CORRUPTED_STATE=254]="ERR_STACKING_CORRUPTED_STATE",t[t.ERR_STACKING_INSUFFICIENT_FUNDS=1]="ERR_STACKING_INSUFFICIENT_FUNDS",t[t.ERR_STACKING_INVALID_LOCK_PERIOD=2]="ERR_STACKING_INVALID_LOCK_PERIOD",t[t.ERR_STACKING_ALREADY_STACKED=3]="ERR_STACKING_ALREADY_STACKED",t[t.ERR_STACKING_NO_SUCH_PRINCIPAL=4]="ERR_STACKING_NO_SUCH_PRINCIPAL",t[t.ERR_STACKING_EXPIRED=5]="ERR_STACKING_EXPIRED",t[t.ERR_STACKING_STX_LOCKED=6]="ERR_STACKING_STX_LOCKED",t[t.ERR_STACKING_PERMISSION_DENIED=9]="ERR_STACKING_PERMISSION_DENIED",t[t.ERR_STACKING_THRESHOLD_NOT_MET=11]="ERR_STACKING_THRESHOLD_NOT_MET",t[t.ERR_STACKING_POX_ADDRESS_IN_USE=12]="ERR_STACKING_POX_ADDRESS_IN_USE",t[t.ERR_STACKING_INVALID_POX_ADDRESS=13]="ERR_STACKING_INVALID_POX_ADDRESS",t[t.ERR_STACKING_ALREADY_REJECTED=17]="ERR_STACKING_ALREADY_REJECTED",t[t.ERR_STACKING_INVALID_AMOUNT=18]="ERR_STACKING_INVALID_AMOUNT",t[t.ERR_NOT_ALLOWED=19]="ERR_NOT_ALLOWED",t[t.ERR_STACKING_ALREADY_DELEGATED=20]="ERR_STACKING_ALREADY_DELEGATED",t[t.ERR_DELEGATION_EXPIRES_DURING_LOCK=21]="ERR_DELEGATION_EXPIRES_DURING_LOCK",t[t.ERR_DELEGATION_TOO_MUCH_LOCKED=22]="ERR_DELEGATION_TOO_MUCH_LOCKED",t[t.ERR_DELEGATION_POX_ADDR_REQUIRED=23]="ERR_DELEGATION_POX_ADDR_REQUIRED",t[t.ERR_INVALID_START_BURN_HEIGHT=24]="ERR_INVALID_START_BURN_HEIGHT",t[t.ERR_NOT_CURRENT_STACKER=25]="ERR_NOT_CURRENT_STACKER",t[t.ERR_STACK_EXTEND_NOT_LOCKED=26]="ERR_STACK_EXTEND_NOT_LOCKED",t[t.ERR_STACK_INCREASE_NOT_LOCKED=27]="ERR_STACK_INCREASE_NOT_LOCKED",t[t.ERR_DELEGATION_NO_REWARD_SLOT=28]="ERR_DELEGATION_NO_REWARD_SLOT",t[t.ERR_DELEGATION_WRONG_REWARD_SLOT=29]="ERR_DELEGATION_WRONG_REWARD_SLOT",t[t.ERR_STACKING_IS_DELEGATED=30]="ERR_STACKING_IS_DELEGATED",t[t.ERR_STACKING_NOT_DELEGATED=31]="ERR_STACKING_NOT_DELEGATED",t))(Ji||{});function Yi(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Qi(...t){const e=(t,e)=>n=>t(e(n));return{encode:Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),decode:t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0)}}function to(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(Yi(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function eo(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function no(t,e="="){if(Yi(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function ro(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function io(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],o=Array.from(t);for(o.forEach((t=>{if(Yi(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,s=!0;for(let i=r;i<o.length;i++){const a=o[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,o[i]=Math.floor(c/n),!Number.isSafeInteger(o[i])||o[i]*n+t!==c)throw new Error("convertRadix: carry overflow");s&&(o[i]?s=!1:r=i)}if(i.push(t),s)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}const oo=(t,e)=>e?oo(e,t%e):t,so=(t,e)=>t+(e-oo(t,e));function ao(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(so(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${so(e,n)}`);let i=0,o=0;const s=2**n-1,a=[];for(const r of t){if(Yi(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(i=i<<e|r,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=n;o-=n)a.push((i>>o-n&s)>>>0);i&=2**o-1}if(i=i<<n-o&s,!r&&o>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&o>0&&a.push(i>>>0),a}function co(t,e=!1){if(Yi(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(so(8,t)>32||so(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return ao(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(ao(n,t,8,e))}}}function uo(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}Qi(co(4),to("0123456789ABCDEF"),eo("")),Qi(co(5),to("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),no(5),eo("")),Qi(co(5),to("0123456789ABCDEFGHIJKLMNOPQRSTUV"),no(5),eo("")),Qi(co(5),to("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),eo(""),ro((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Qi(co(6),to("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),no(6),eo("")),Qi(co(6),to("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),no(6),eo(""));const ho=t=>{return Qi((Yi(e=58),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return io(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(io(t,e,256))}}),to(t),eo(""));var e},fo=(ho("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),ho("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),ho("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Qi(to("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),eo(""))),lo=[996825010,642813549,513874426,1027748829,705979059];function po(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<lo.length;t++)1==(e>>t&1)&&(n^=lo[t]);return n}function go(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=po(i)^n>>5}i=po(i);for(let e=0;e<r;e++)i=po(i)^31&t.charCodeAt(e);for(let t of e)i=po(i)^t;for(let t=0;t<6;t++)i=po(i);return i^=n,fo.encode(ao([i%2**30],30,5,!1))}function yo(t){const e="bech32"===t?1:734539939,n=co(5),r=n.decode,i=n.encode,o=uo(r);function s(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(t=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const o=t.slice(0,i),s=t.slice(i+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=fo.decode(s).slice(0,-6),c=go(o,a,e);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:o,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${fo.encode(n)}${go(t,n,e)}`},decode:s,decodeToBytes:function(t){const{prefix:e,words:n}=s(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:uo(s),fromWords:r,fromWordsUnsafe:o,toWords:i}}const wo=yo("bech32"),bo=yo("bech32m");Qi(co(4),to("0123456789abcdef"),eo(""),ro((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));var Ao=i(22),mo=i.n(Ao);Dn.hmacSha256Sync=(t,...e)=>{const n=or.create(se,t);return e.forEach((t=>n.update(t))),n.digest()},i(766);const Eo=9007199254740991;function So(t){if(t<0||t>Eo||t%1!=0)throw new RangeError("value out of range")}const vo="Stacks Signed Message:\n";function xo(t,e=vo){const n="string"==typeof t?l(t):t,r=function(t,e,n=0){return So(t),e||(e=new Uint8Array(function(t){return So(t),t<253?1:t<=65535?3:t<=4294967295?5:9}(t))),t<253?W(e,t,n):t<=65535?(W(e,253,n),function(t,e,n=0){t[n+0]=255&e,e>>>=8,t[n+1]=255&e}(e,t,n+1)):t<=4294967295?(W(e,254,n),q(e,t,n+1)):(W(e,255,n),q(e,t>>>0,n+1),q(e,t/4294967296|0,n+5)),e}(n.length);return A(l(e),r,n)}var Io;Dn.hmacSha256Sync=(t,...e)=>{const n=or.create(se,t);return e.forEach((t=>n.update(t))),n.digest()},function(t){t.InvalidFormat="InvalidFormat",t.IsNotPoint="IsNotPoint"}(Io||(Io={}));const Co=new Uint8Array([83,73,80,48,49,56]);function _o(t){return se(Gr(t))}function To({message:t,domain:e}){const n=_o(t);if((r=e).type!==$n.Tuple||!["name","version","chain-id"].every((t=>t in r.value))||!["name","version"].every((t=>r.value[t].type===$n.StringASCII))||r.value["chain-id"].type!==$n.UInt)throw new Error("domain parameter must be a valid domain of type TupleCV with keys 'name', 'version', 'chain-id' with respective types StringASCII, StringASCII, UInt");var r;const i=_o(e);return A(Co,i,n)}var Po=Object.defineProperty,ko=Object.defineProperties,Ro=Object.getOwnPropertyDescriptors,Oo=Object.getOwnPropertySymbols,Bo=Object.prototype.hasOwnProperty,No=Object.prototype.propertyIsEnumerable,Uo=(t,e,n)=>e in t?Po(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ho=(t,e)=>{for(var n in e||(e={}))Bo.call(e,n)&&Uo(t,n,e[n]);if(Oo)for(var n of Oo(e))No.call(e,n)&&Uo(t,n,e[n]);return t},Do=(t,e)=>ko(t,Ro(e));class $o extends Error{constructor(t,e){const n=`'${t}' is not a valid P2PKH/P2SH/P2WPKH/P2WSH/P2TR address`;super(n),this.message=n,this.name=this.constructor.name,this.innerError=e,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}function Lo(t){switch(t){case ji.mainnet.P2PKH:case ji.testnet.P2PKH:return Mi.P2PKH;case ji.mainnet.P2SH:case ji.testnet.P2SH:return Mi.P2SH;default:throw new Error("Invalid pox address version")}}function Ko(t){const{version:e,data:n}=Mo(t);return{version:e,data:d(n)}}function Mo(t){try{if(Gi.test(t)){const e=function(t){const e=mo().decode(t),n=e.slice(0,-4),r=e.slice(-4),i=se(se(n));if(r[0]^i[0]|r[1]^i[1]|r[2]^i[2]|r[3]^i[3])throw new Error("Invalid checksum");if(21!==n.length)throw new TypeError("Invalid address length");return{version:F(n,0),hash:n.slice(1)}}(t);return{version:Lo(e.version),data:e.hash}}if(qi.test(t)){const e=function(t){if(Fi.test(t))return function(t){const{words:e}=wo.decode(t),n=e[0];if(n>0)throw new Error("Addresses with a witness version >= 1 should be encoded in bech32m");return{witnessVersion:n,data:wo.fromWords(e.slice(1))}}(t);if(Wi.test(t))return function(t){const{words:e}=bo.decode(t),n=e[0];if(0==n)throw new Error("Addresses with witness version 1 should be encoded in bech32");return{witnessVersion:n,data:bo.fromWords(e.slice(1))}}(t);throw new Error(`Native segwit address ${t} does not match valid prefix ${Fi} or ${Wi}`)}(t);return{version:function(t,e){if(t===zi&&20===e)return Mi.P2WPKH;if(t===zi&&32===e)return Mi.P2WSH;if(t===Xi&&32===e)return Mi.P2TR;throw new Error("Invalid native segwit witness version and byte length. Currently, only P2WPKH, P2WSH, and P2TR are supported.")}(e.witnessVersion,e.data.length),data:e.data}}throw new Error("Unknown BTC address prefix.")}catch(e){throw new $o(t,e)}}function jo(t){const e=t;if(e.type!==$n.Tuple||!e.value)throw new Error("Invalid argument, expected ClarityValue to be a TupleCV");if(!("version"in e.value)||!("hashbytes"in e.value))throw new Error("Invalid argument, expected Clarity tuple value to contain `version` and `hashbytes` keys");const n=e.value.version,r=e.value.hashbytes;if(n.type!==$n.Buffer||r.type!==$n.Buffer)throw new Error("Invalid argument, expected Clarity tuple value to contain `version` and `hashbytes` buffers");return{version:f(n.value)[0],hashBytes:f(r.value)}}function Go(t){switch(t){case Ji.ERR_STACKING_UNREACHABLE:return"Stacking unreachable";case Ji.ERR_STACKING_CORRUPTED_STATE:return"Stacking state is corrupted";case Ji.ERR_STACKING_INSUFFICIENT_FUNDS:return"Insufficient funds";case Ji.ERR_STACKING_INVALID_LOCK_PERIOD:return"Invalid lock period";case Ji.ERR_STACKING_ALREADY_STACKED:return"Account already stacked. Concurrent stacking not allowed.";case Ji.ERR_STACKING_NO_SUCH_PRINCIPAL:return"Principal does not exist";case Ji.ERR_STACKING_EXPIRED:return"Stacking expired";case Ji.ERR_STACKING_STX_LOCKED:return"STX balance is locked";case Ji.ERR_STACKING_PERMISSION_DENIED:return"Permission denied";case Ji.ERR_STACKING_THRESHOLD_NOT_MET:return"Stacking threshold not met";case Ji.ERR_STACKING_POX_ADDRESS_IN_USE:return"PoX address already in use";case Ji.ERR_STACKING_INVALID_POX_ADDRESS:return"Invalid PoX address";case Ji.ERR_STACKING_ALREADY_REJECTED:return"Stacking already rejected";case Ji.ERR_STACKING_INVALID_AMOUNT:return"Invalid amount";case Ji.ERR_NOT_ALLOWED:return"Stacking not allowed";case Ji.ERR_STACKING_ALREADY_DELEGATED:return"Already delegated";case Ji.ERR_DELEGATION_EXPIRES_DURING_LOCK:return"Delegation expires during lock period";case Ji.ERR_DELEGATION_TOO_MUCH_LOCKED:return"Delegation too much locked";case Ji.ERR_DELEGATION_POX_ADDR_REQUIRED:return"PoX address required for delegation";case Ji.ERR_INVALID_START_BURN_HEIGHT:return"Invalid start burn height";case Ji.ERR_NOT_CURRENT_STACKER:return"ERR_NOT_CURRENT_STACKER";case Ji.ERR_STACK_EXTEND_NOT_LOCKED:case Ji.ERR_STACK_INCREASE_NOT_LOCKED:return"Stacker must be currently locked";case Ji.ERR_DELEGATION_NO_REWARD_SLOT:return"Invalid reward-cycle and reward-cycle-index";case Ji.ERR_DELEGATION_WRONG_REWARD_SLOT:return"PoX address must match the one on record";case Ji.ERR_STACKING_IS_DELEGATED:return"Stacker must be directly stacking and not delegating";case Ji.ERR_STACKING_NOT_DELEGATED:return"Stacker must be delegating and not be directly stacking"}}function Fo(t){const{version:e,data:n}=Mo(t);return Cr({version:Zn(c(BigInt(e),1)),hashbytes:Zn(n)})}function Wo(t,e,n){if(!U.includes(n))throw new Error("Invalid network.");switch("string"==typeof e&&(e=f(e)),t){case Mi.P2PKH:case Mi.P2SH:case Mi.P2SHP2WPKH:case Mi.P2SHP2WSH:{const r=function(t,e){switch(t){case Mi.P2PKH:return ji[e].P2PKH;case Mi.P2SH:case Mi.P2SHP2WPKH:case Mi.P2SHP2WSH:return ji[e].P2SH;default:throw new Error("Invalid pox address version")}}(t,n);return function(t,e){return function(t){const e=se(se(t));return mo().encode(A(t,e).slice(0,t.length+4))}(A(new Uint8Array([t]),e.slice(0,20)))}(r,e)}case Mi.P2WPKH:case Mi.P2WSH:{const t=wo.toWords(e);return wo.encode(Vi[n],[zi,...t])}case Mi.P2TR:{const t=bo.toWords(e);return bo.encode(Vi[n],[Xi,...t])}}throw new Error(`Unexpected address version: ${t}`)}function Vo(...t){return"number"==typeof t[0]?Wo(t[0],t[1],t[2]):function(t,e){const n=jo(t);return Wo(n.version,n.hashBytes,e)}(t[0],t[1])}function qo(t){if(t.type===$n.OptionalSome)return t.value;if(t.type!==$n.OptionalNone)throw new Error("Object is not an 'Optional'")}function zo(t,e){if(t.type===$n.OptionalSome)return e(t.value);if(t.type!==$n.OptionalNone)throw new Error("Object is not an 'Optional'")}function Xo(t){if(t.period===Zi.Period1)throw new Error(`PoX-2 has not activated yet (currently in period ${t.period} of PoX-2 operation)`)}function Zo({contract:t,poxAddress:e}){if(e&&t.endsWith(".pox")&&!Gi.test(e))throw new Error("PoX-1 requires P2PKH/P2SH/P2SH-P2WPKH/P2SH-P2WSH bitcoin addresses")}function Jo({contract:t,signerKey:e,signerSignature:n,maxAmount:r,authId:i}){const o=void 0!==r,s=void 0!==i;if(/\.pox(-[2-3])?$/.test(t)){if(e||n||o||s)throw new Error("PoX-1, PoX-2 and PoX-3 do not accept a `signerKey`, `signerSignature`, `maxAmount` or `authId`")}else if(!e||!o||void 0===i)throw new Error("PoX-4 requires a `signerKey` (buff 33), `maxAmount` (uint), and `authId` (uint)")}var Yo=(t=>(t.StackStx="stack-stx",t.AggregateCommit="agg-commit",t.AggregateIncrease="agg-increase",t.StackExtend="stack-extend",t.StackIncrease="stack-increase",t))(Yo||{});function Qo({topic:t,poxAddress:e,rewardCycle:n,period:r,network:i,privateKey:o,maxAmount:s,authId:a}){return function({message:t,domain:e,privateKey:n}){return function({messageHash:t,privateKey:e}){return(n=yr(e,t)).slice(2)+n.slice(0,2);var n}({messageHash:d(se(To({message:t,domain:e}))),privateKey:n})}(Do(Ho({},es({topic:t,poxAddress:e,rewardCycle:n,period:r,network:i,maxAmount:s,authId:a})),{privateKey:o}))}function ts({topic:t,poxAddress:e,rewardCycle:n,period:i,network:o,publicKey:s,signature:a,maxAmount:c,authId:u}){return function({signature:t,message:e,publicKey:n}){return function({signature:t,message:e,publicKey:n}){const{r:i,s:o}=ar(t),s=new on(r(i),r(o)),a=Nn(s,"string"==typeof e?function(t,e=vo){return se(xo(t,e))}(e):e,n,{strict:!1});return a||"string"!=typeof e?a:Nn(s,se(xo(e,"Stacks Message Signing:\n")),n,{strict:!1})}({signature:cr(t),message:e,publicKey:n})}({message:se(To(es({topic:t,poxAddress:e,rewardCycle:n,period:i,network:o,maxAmount:c,authId:u}))),publicKey:s,signature:a})}function es({topic:t,poxAddress:e,rewardCycle:n,period:r,network:i,maxAmount:o,authId:s}){const a=H(i);return{message:Cr({"pox-addr":Fo(e),"reward-cycle":Xn(n),topic:_r(t),period:Xn(r),"max-amount":Xn(o),"auth-id":Xn(s)}),domain:Cr({name:_r("pox-4-signer"),version:_r("1.0.0"),"chain-id":Xn(a.chainId)})}}var ns=Object.defineProperty,rs=Object.getOwnPropertySymbols,is=Object.prototype.hasOwnProperty,os=Object.prototype.propertyIsEnumerable,ss=(t,e,n)=>e in t?ns(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,as=(t,e)=>{for(var n in e||(e={}))is.call(e,n)&&ss(t,n,e[n]);if(rs)for(var n of rs(e))os.call(e,n)&&ss(t,n,e[n]);return t},cs=(t,e)=>{var n={};for(var r in t)is.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&rs)for(var r of rs(t))e.indexOf(r)<0&&os.call(t,r)&&(n[r]=t[r]);return n};class us{constructor(t){var e;this.address=t.address,this.network=H(null!=(e=t.network)?e:"mainnet"),this.client=Object.assign({},D(this.network),t.client)}get baseUrl(){return this.client.baseUrl}get fetch(){return this.client.fetch}getCoreInfo(){return this.client.fetch(`${this.client.baseUrl}/v2/info`).then((t=>t.json()))}getPoxInfo(){return this.client.fetch(`${this.client.baseUrl}/v2/pox`).then((t=>t.json()))}async getTargetBlockTime(){const t=await this.client.fetch(`${this.client.baseUrl}/extended/v1/info/network_block_times`).then((t=>t.json()));return this.network.chainId===C.Mainnet?t.mainnet.target_block_time:t.testnet.target_block_time}async getAccountStatus(){return this.client.fetch(`${this.client.baseUrl}/v2/accounts/${this.address}?proof=0`).then((t=>t.json())).then((t=>(t.balance=BigInt(t.balance),t.locked=BigInt(t.locked),t)))}async getAccountBalance(){return this.getAccountStatus().then((t=>t.balance))}async getAccountExtendedBalances(){return this.client.fetch(`${this.client.baseUrl}/extended/v1/address/${this.address}/balances`).then((t=>t.json())).then((t=>(t.stx.balance=BigInt(t.stx.balance),t.stx.total_sent=BigInt(t.stx.total_sent),t.stx.total_received=BigInt(t.stx.total_received),t.stx.locked=BigInt(t.stx.locked),t)))}async getAccountBalanceLocked(){return this.getAccountStatus().then((t=>t.locked))}async getCycleDuration(){const t=this.getPoxInfo(),e=await this.getTargetBlockTime();return Promise.all([t,e]).then((([t,e])=>t.reward_cycle_length*e))}async getRewardsTotalForBtcAddress(){return this.client.fetch(`${this.client.baseUrl}/extended/v1/burnchain/rewards/${this.address}/total`).then((t=>t.json())).then((t=>(t.reward_amount=BigInt(t.reward_amount),t)))}async getRewardsForBtcAddress(t){let e=`${this.client.baseUrl}/extended/v1/burnchain/rewards/${this.address}`;return t&&(e+=`?limit=${t.limit}&offset=${t.offset}`),this.client.fetch(e).then((t=>t.json()))}async getRewardHoldersForBtcAddress(t){let e=`${this.client.baseUrl}/extended/v1/burnchain/reward_slot_holders/${this.address}`;return t&&(e+=`?limit=${t.limit}&offset=${t.offset}`),this.client.fetch(e).then((t=>t.json()))}async getRewardSet(t){const[e,n]=this.parseContractId(null==t?void 0:t.contractId);return zo(await Ei({client:this.client,senderAddress:this.address,contractAddress:e,contractName:n,functionArgs:[Xn(t.rewardCyleId),Xn(t.rewardSetIndex)],functionName:"get-reward-set-pox-address"}),(t=>({pox_address:{version:f(t.value["pox-addr"].value.version.value),hashbytes:f(t.value["pox-addr"].value.hashbytes.value)},total_ustx:BigInt(t.value["total-ustx"].value)})))}async getSecondsUntilNextCycle(){const t=this.getPoxInfo(),e=this.getTargetBlockTime(),n=this.getCoreInfo();return Promise.all([t,e,n]).then((([t,e,n])=>(t.reward_cycle_length-(n.burn_block_height-t.first_burnchain_block_height)%t.reward_cycle_length)*e))}async getSecondsUntilStackingDeadline(){const t=this.getPoxInfo(),e=this.getTargetBlockTime();return Promise.all([t,e]).then((([t,e])=>t.next_cycle.blocks_until_prepare_phase*e))}async getPoxOperationInfo(t){const e=[...(t=null!=t?t:await this.getPoxInfo()).contract_versions].sort(((t,e)=>t.activation_burnchain_block_height-e.activation_burnchain_block_height)),[n,r,i,o]=e,s=e.filter((e=>(null==t?void 0:t.current_burnchain_block_height)>=e.activation_burnchain_block_height)),a=s[s.length-1];return{period:Zi.Period3,pox1:n,pox2:r,pox3:i,pox4:o,current:a}}async hasMinimumStx(){return await this.getAccountBalance()>=BigInt((await this.getPoxInfo()).min_amount_ustx)}async canStack({poxAddress:t,cycles:e}){const n=this.getAccountBalance(),r=this.getPoxInfo();return Promise.all([n,r]).then((([n,r])=>{const i=Fo(t),[o,s]=this.parseContractId(r.contract_id);return Ei({client:this.client,contractName:s,contractAddress:o,functionName:"can-stack-stx",senderAddress:this.address,functionArgs:[i,Xn(n.toString()),Xn(r.reward_cycle_id),Xn(e.toString())]})})).then((t=>t.type===$n.ResponseOk?{eligible:!0}:{eligible:!1,reason:Ji[+Si(t.value)]}))}async stack(t){var e=t,{amountMicroStx:n,poxAddress:r,cycles:i,burnBlockHeight:o,signerKey:s,signerSignature:a,maxAmount:c,authId:u}=e,h=cs(e,["amountMicroStx","poxAddress","cycles","burnBlockHeight","signerKey","signerSignature","maxAmount","authId"]);const d=await this.getPoxInfo(),f=await this.getPoxOperationInfo(d),l=await this.getStackingContract(f);Zo({contract:l,poxAddress:r}),Jo({contract:l,signerKey:s,signerSignature:a,maxAmount:c,authId:u});const p=this.getStackOptions({contract:l,amountMicroStx:n,cycles:i,poxAddress:r,burnBlockHeight:o,signerKey:s,signerSignature:a,maxAmount:c,authId:u});return mi({transaction:await Li(as(as({},p),hs(h))),client:this.client})}async stackExtend(t){var e=t,{extendCycles:n,poxAddress:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a}=e,c=cs(e,["extendCycles","poxAddress","signerKey","signerSignature","maxAmount","authId"]);const u=await this.getPoxInfo();Xo(await this.getPoxOperationInfo(u)),Jo({contract:u.contract_id,signerKey:i,signerSignature:o,maxAmount:s,authId:a});const h=this.getStackExtendOptions({contract:u.contract_id,extendCycles:n,poxAddress:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a});return mi({transaction:await Li(as(as({},h),hs(c))),client:this.client})}async stackIncrease(t){var e=t,{increaseBy:n,signerKey:r,signerSignature:i,maxAmount:o,authId:s}=e,a=cs(e,["increaseBy","signerKey","signerSignature","maxAmount","authId"]);const c=await this.getPoxInfo();Xo(await this.getPoxOperationInfo(c)),Jo({contract:c.contract_id,signerKey:r,signerSignature:i,maxAmount:o,authId:s});const u=this.getStackIncreaseOptions({contract:c.contract_id,increaseBy:n,signerKey:r,signerSignature:i,maxAmount:o,authId:s});return mi({transaction:await Li(as(as({},u),hs(a))),client:this.client})}async delegateStx(t){var e=t,{amountMicroStx:n,delegateTo:r,untilBurnBlockHeight:i,poxAddress:o}=e,s=cs(e,["amountMicroStx","delegateTo","untilBurnBlockHeight","poxAddress"]);const a=await this.getPoxInfo(),c=await this.getPoxOperationInfo(a),u=await this.getStackingContract(c);Zo({contract:u,poxAddress:o});const h=this.getDelegateOptions({contract:u,amountMicroStx:n,delegateTo:r,untilBurnBlockHeight:i,poxAddress:o});return mi({transaction:await Li(as(as({},h),hs(s))),client:this.client})}async delegateStackStx(t){var e=t,{stacker:n,amountMicroStx:r,poxAddress:i,burnBlockHeight:o,cycles:s}=e,a=cs(e,["stacker","amountMicroStx","poxAddress","burnBlockHeight","cycles"]);const c=await this.getPoxInfo(),u=await this.getPoxOperationInfo(c),h=await this.getStackingContract(u);Zo({contract:h,poxAddress:i});const d=this.getDelegateStackOptions({contract:h,stacker:n,amountMicroStx:r,poxAddress:i,burnBlockHeight:o,cycles:s});return mi({transaction:await Li(as(as({},d),hs(a))),client:this.client})}async delegateStackExtend(t){var e=t,{stacker:n,poxAddress:r,extendCount:i}=e,o=cs(e,["stacker","poxAddress","extendCount"]);const s=(await this.getPoxInfo()).contract_id,a=this.getDelegateStackExtendOptions({contract:s,stacker:n,poxAddress:r,extendCount:i});return mi({transaction:await Li(as(as({},a),hs(o))),client:this.client})}async delegateStackIncrease(t){var e=t,{stacker:n,poxAddress:r,increaseBy:i}=e,o=cs(e,["stacker","poxAddress","increaseBy"]);const s=await this.getPoxInfo();Xo(await this.getPoxOperationInfo(s));const a=this.getDelegateStackIncreaseOptions({contract:s.contract_id,stacker:n,poxAddress:r,increaseBy:i});return mi({transaction:await Li(as(as({},a),hs(o))),client:this.client})}async stackAggregationCommit(t){var e=t,{poxAddress:n,rewardCycle:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a}=e,c=cs(e,["poxAddress","rewardCycle","signerKey","signerSignature","maxAmount","authId"]);const u=await this.getStackingContract();Zo({contract:u,poxAddress:n}),Jo({contract:u,signerKey:i,signerSignature:o,maxAmount:s,authId:a});const h=this.getStackAggregationCommitOptions({contract:u,poxAddress:n,rewardCycle:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a});return mi({transaction:await Li(as(as({},h),hs(c))),client:this.client})}async stackAggregationCommitIndexed(t){var e=t,{poxAddress:n,rewardCycle:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a}=e,c=cs(e,["poxAddress","rewardCycle","signerKey","signerSignature","maxAmount","authId"]);const u=await this.getStackingContract();Zo({contract:u,poxAddress:n}),Jo({contract:u,signerKey:i,signerSignature:o,maxAmount:s,authId:a});const h=this.getStackAggregationCommitOptionsIndexed({contract:u,poxAddress:n,rewardCycle:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a});return mi({transaction:await Li(as(as({},h),hs(c))),client:this.client})}async stackAggregationIncrease(t){var e=t,{poxAddress:n,rewardCycle:r,rewardIndex:i,signerKey:o,signerSignature:s,maxAmount:a,authId:c}=e,u=cs(e,["poxAddress","rewardCycle","rewardIndex","signerKey","signerSignature","maxAmount","authId"]);const h=await this.getStackingContract();Zo({contract:h,poxAddress:n}),Jo({contract:h,signerKey:o,signerSignature:s,maxAmount:a,authId:c});const d=this.getStackAggregationIncreaseOptions({contract:h,poxAddress:n,rewardCycle:r,rewardCycleIndex:i,signerKey:o,signerSignature:s,maxAmount:a,authId:c});return mi({transaction:await Li(as(as({},d),hs(u))),client:this.client})}async revokeDelegateStx(t){"string"==typeof t&&(t={privateKey:t});const e=(await this.getPoxInfo()).contract_id,n=this.getRevokeDelegateStxOptions(e);return mi({transaction:await Li(as(as({},n),hs(t))),client:this.client})}getStackOptions({amountMicroStx:t,poxAddress:e,cycles:n,contract:r,burnBlockHeight:i,signerKey:o,signerSignature:s,maxAmount:a,authId:c}){const u=Fo(e),[h,d]=this.parseContractId(r),l=[Xn(t),u,Xn(i),Xn(n)];return o&&a&&void 0!==c&&(l.push(s?Ir(Zn(f(s))):xr()),l.push(Zn(f(o))),l.push(Xn(a)),l.push(Xn(c))),{client:this.client,contractAddress:h,contractName:d,functionName:"stack-stx",functionArgs:l,validateWithAbi:!0,network:this.network}}getStackExtendOptions({extendCycles:t,poxAddress:e,contract:n,signerKey:r,signerSignature:i,maxAmount:o,authId:s}){const a=Fo(e),[c,u]=this.parseContractId(n),h=[Xn(t),a];return r&&o&&void 0!==s&&(h.push(i?Ir(Zn(f(i))):xr()),h.push(Zn(f(r))),h.push(Xn(o)),h.push(Xn(s))),{client:this.client,contractAddress:c,contractName:u,functionName:"stack-extend",functionArgs:h,validateWithAbi:!0,network:this.network}}getStackIncreaseOptions({increaseBy:t,contract:e,signerKey:n,signerSignature:r,maxAmount:i,authId:o}){const[s,a]=this.parseContractId(e),c=[Xn(t)];return n&&i&&void 0!==o&&(c.push(r?Ir(Zn(f(r))):xr()),c.push(Zn(f(n))),c.push(Xn(i)),c.push(Xn(o))),{client:this.client,contractAddress:s,contractName:a,functionName:"stack-increase",functionArgs:c,validateWithAbi:!0,network:this.network}}getDelegateOptions({contract:t,amountMicroStx:e,delegateTo:n,untilBurnBlockHeight:r,poxAddress:i}){const o=i?Ir(Fo(i)):xr(),[s,a]=this.parseContractId(t);return{client:this.client,contractAddress:s,contractName:a,functionName:"delegate-stx",functionArgs:[Xn(e),Sr(n),r?Ir(Xn(r)):xr(),o],validateWithAbi:!0,network:this.network}}getDelegateStackOptions({contract:t,stacker:e,amountMicroStx:n,poxAddress:r,burnBlockHeight:i,cycles:o}){const s=Fo(r),[a,c]=this.parseContractId(t);return{client:this.client,contractAddress:a,contractName:c,functionName:"delegate-stack-stx",functionArgs:[Sr(e),Xn(n),s,Xn(i),Xn(o)],validateWithAbi:!0,network:this.network}}getDelegateStackExtendOptions({contract:t,stacker:e,poxAddress:n,extendCount:r}){const i=Fo(n),[o,s]=this.parseContractId(t);return{client:this.client,contractAddress:o,contractName:s,functionName:"delegate-stack-extend",functionArgs:[Sr(e),i,Xn(r)],validateWithAbi:!0,network:this.network}}getDelegateStackIncreaseOptions({contract:t,stacker:e,poxAddress:n,increaseBy:r}){const i=Fo(n),[o,s]=this.parseContractId(t);return{client:this.client,contractAddress:o,contractName:s,functionName:"delegate-stack-increase",functionArgs:[Sr(e),i,Xn(r)],validateWithAbi:!0,network:this.network}}getStackAggregationCommitOptions({contract:t,poxAddress:e,rewardCycle:n,signerKey:r,signerSignature:i,maxAmount:o,authId:s}){const a=Fo(e),[c,u]=this.parseContractId(t),h=[a,Xn(n)];return r&&o&&void 0!==s&&(h.push(i?Ir(Zn(f(i))):xr()),h.push(Zn(f(r))),h.push(Xn(o)),h.push(Xn(s))),{client:this.client,contractAddress:c,contractName:u,functionName:"stack-aggregation-commit",functionArgs:h,validateWithAbi:!0,network:this.network}}getStackAggregationIncreaseOptions({contract:t,poxAddress:e,rewardCycle:n,rewardCycleIndex:r,signerKey:i,signerSignature:o,maxAmount:s,authId:a}){const c=Fo(e),[u,h]=this.parseContractId(t),d=[c,Xn(n),Xn(r)];return i&&s&&void 0!==a&&(d.push(o?Ir(Zn(f(o))):xr()),d.push(Zn(f(i))),d.push(Xn(s)),d.push(Xn(a))),{client:this.client,contractAddress:u,contractName:h,functionName:"stack-aggregation-increase",functionArgs:d,validateWithAbi:!0,network:this.network}}getStackAggregationCommitOptionsIndexed({contract:t,poxAddress:e,rewardCycle:n,signerKey:r,signerSignature:i,maxAmount:o,authId:s}){const a=Fo(e),[c,u]=this.parseContractId(t),h=[a,Xn(n)];return r&&o&&void 0!==s&&(h.push(i?Ir(Zn(f(i))):xr()),h.push(Zn(f(r))),h.push(Xn(o)),h.push(Xn(s))),{client:this.client,contractAddress:c,contractName:u,functionName:"stack-aggregation-commit-indexed",functionArgs:h,validateWithAbi:!0,network:this.network}}getRevokeDelegateStxOptions(t){const[e,n]=this.parseContractId(t);return{client:this.client,contractAddress:e,contractName:n,functionName:"revoke-delegate-stx",functionArgs:[],validateWithAbi:!0,network:this.network}}async getStatus(){const t=await this.getPoxInfo(),[e,n]=this.parseContractId(t.contract_id),r=await this.getAccountStatus();return Ei({contractAddress:e,contractName:n,functionName:"get-stacker-info",senderAddress:this.address,functionArgs:[Sr(this.address)],client:this.client}).then((t=>{if(t.type===$n.OptionalSome){const e=t.value,n=e.value["pox-addr"],i=e.value["first-reward-cycle"],o=e.value["lock-period"],s=n.value.version,a=n.value.hashbytes;return{stacked:!0,details:{first_reward_cycle:Number(i.value),lock_period:Number(o.value),unlock_height:r.unlock_height,pox_address:{version:f(s.value),hashbytes:f(a.value)}}}}if(t.type===$n.OptionalNone)return{stacked:!1};throw new Error("Error fetching stacker info")}))}async getDelegationStatus(){const t=await this.getPoxInfo(),[e,n]=this.parseContractId(t.contract_id);return Ei({contractAddress:e,contractName:n,functionName:"get-delegation-info",functionArgs:[Sr(this.address)],senderAddress:this.address,client:this.client}).then((t=>{if(t.type===$n.OptionalSome){const e=t.value,n=e.value["amount-ustx"],r=e.value["delegated-to"],i=zo(e.value["pox-addr"],(t=>({version:f(t.value.version.value)[0],hashbytes:f(t.value.hashbytes.value)}))),o=qo(e.value["until-burn-ht"]);return{delegated:!0,details:{amount_micro_stx:BigInt(n.value),delegated_to:r.value,pox_address:i,until_burn_ht:o?Number(o.value):void 0}}}if(t.type===$n.OptionalNone)return{delegated:!1};throw new Error("Error fetching delegation info")}))}async verifySignerKeySignature({topic:t,poxAddress:e,rewardCycle:n,period:r,signerSignature:i,signerKey:o,amount:s,maxAmount:a,authId:c}){const u=await this.getPoxInfo(),[h,d]=this.parseContractId(u.contract_id);return Ei({contractAddress:h,contractName:d,functionName:"verify-signer-key-sig",functionArgs:[Fo(e),Xn(n),_r(t),Xn(r),i?Ir(Zn(f(i))):xr(),Zn(f(o)),Xn(s),Xn(a),Xn(c)],senderAddress:this.address,client:this.client}).then((t=>t.type===$n.ResponseOk))}async getStackingContract(t){switch((t=null!=t?t:await this.getPoxOperationInfo()).period){case Zi.Period1:return t.pox1.contract_id;case Zi.Period2a:case Zi.Period2b:return t.pox2.contract_id;case Zi.Period3:default:return t.current.contract_id}}modifyLockTxFee({tx:t,amountMicroStx:n}){const r=function(t){switch(t.authType){case ht.Standard:return t.spendingCondition.fee;case ht.Sponsored:return t.sponsorSpendingCondition.fee}}(t.auth);return t.payload.functionArgs[0]=Xn(e(n)-r),t}parseContractId(t){const e=t.split(".");if(2===e.length&&(t=>{try{return(0,Mn.yI)(t),!0}catch(t){return!1}})(e[0])&&e[1].startsWith("pox"))return e;throw new Error("Stacking contract ID is malformed")}signPoxSignature({topic:t,poxAddress:e,rewardCycle:n,period:r,signerPrivateKey:i,authId:o,maxAmount:s}){return Qo({topic:t,poxAddress:e,rewardCycle:n,period:r,network:this.network,privateKey:i,maxAmount:s,authId:o})}}function hs(t){return t.senderKey=t.privateKey,delete t.privateKey,t}})(),o})()));
//# sourceMappingURL=index.js.map